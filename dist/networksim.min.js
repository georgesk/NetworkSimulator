var AnimationControls={MSG_ADVANCE_PRE:0,MSG_ADVANCE:2,controlsWindow:null,setSpeed:function(e){this.MSG_ADVANCE*=e,16<this.MSG_ADVANCE?this.MSG_ADVANCE=16:this.MSG_ADVANCE<.125&&(this.MSG_ADVANCE=.125)},playPause:function(){var e=this.MSG_ADVANCE;this.MSG_ADVANCE=this.MSG_ADVANCE_PRE,this.MSG_ADVANCE_PRE=e}};function createControlsWindow(){AnimationControls.controlsWindow=new UIWindow("controlswindow","Animation Controls",200,50,!1,1);var e=AnimationControls.controlsWindow.getPos();AnimationControls.controlsWindow.setPos(e.x,5);AnimationControls.controlsWindow.setControls('<img src="img/64/minus.png" alt="Slow" title="Slow" onclick="AnimationControls.setSpeed(0.5);" style="width:32px;" /><img src="img/64/playpause.png" alt="Play/Pause" title="Play/Pause" onclick="AnimationControls.playPause();" style="width:32px;" /><img src="img/64/plus.png" alt="Fast" title="Fast" onclick="AnimationControls.setSpeed(2);" style="width:32px;" />'),AnimationControls.controlsWindow.render()}var Connectable=function(e,n,i,t,o){this.id=getNextID();var a=[],r=[],s=[],n=n,i=i,l=null,c=[],d=[],o=o,u=null,g=this,f=e;function p(){for(var e="0123456789ABCDEF",t="",n=0;n<12;n++)t+=e.charAt(Math.floor(Math.random()*e.length)),n%2==1&&11!==n&&(t+=":");r.push(t)}function v(){s.push(new IPInfo)}this.save=function(){var e={version:1};e.id=this.id,e.connectors=[],e.macaddresses=[],e.ipinfos=[],e.macmode=n,e.ipmode=i,e.trafficManager=l.save(),e.gateways=u.save(),e.performNAT=o;for(var t=0;t<a.length;t++)e.connectors.push(a[t].save());e.macaddresses=r;for(t=0;t<s.length;t++)e.ipinfos.push(s[t].save());return e},this.load=function(e){this.id=e.id;for(var t=0;t<e.connectors.length;t++)a[t].load(e.connectors[t]);r=e.macaddresses;for(t=0;t<e.ipinfos.length;t++)s[t].load(e.ipinfos[t]);n=e.macmode,i=e.ipmode,void 0!==e.performNAT&&this.setPerformNAT(e.performNAT),l.load(e.trafficManager),u.load(e.gateways||null)},this.updateAddressing=function(e,t){d[e]=t},this.isInMyNetworks=function(e){for(var t=!1,n=0;!1===t&&n<a.length;){var i=this.getIPInfo(n);null!=i.getIPv4()&&(t=i.sameNetwork(e),n++)}return t},this.getDstMAC=function(e){return"255.255.255.255"==e?"FF:FF:FF:FF:FF:FF":this.isInMyNetworks(e)?this.findMACforIP(e,null):this.findMACforIP(u.getGatewayForIP(e,null))},this.findMACforIP=function(e,t){var n=null;if(null!==e)for(var i,o,r=0;null===n&&r<a.length;)a[r]===t||null!==(i=a[r].getConnectedConnector())&&(null!==(o=i.getIPInfo())&&!o.sameNetwork(e)||null===(n=i.whoHas(e))||(c[e]=n,d[n]=r)),r++;return n},this.getTrafficManager=function(){return l},this.getGatewayManager=function(){return u},this.addConnector=function(e){a.push(e),n===MACMODE_UNIQUE&&p(),i===IPMODE_UNIQUE&&v()},this.removeConnector=function(e){a.slice(e,1)},this.getConnector=function(e){return a[e]},this.getConnectorNumber=function(){return a.length},this.getOwner=function(){return f},this.getMAC=function(e){var t=null;return t=e<r.length?r[e=n===MACMODE_SHARED?0:e]:t},this.getIPInfo=function(e){var t=null;return t=e<s.length?s[e=i===IPMODE_SHARED?0:e]:t},this.getFirstFreeConnector=function(){for(var e=!1,t=0;!1===e&&t<a.length;)a[t].isConnected()?t++:e=a[t];return e},this.compatibleIP=function(e,t){var n=t&&this.compatibleBroadcastIP(e);if(!n)for(var i=0;!n&&i<s.length;)n=s[i].getIPv4()===e,i++;return n},this.compatibleBroadcastIP=function(e){return"255.255.255.255"===e},this.compatibleMAC=function(e,t){var n=t&&this.compatibleBroadcastMAC(e);if(!n)for(var i=0;!n&&i<r.length;)n=r[i]===e,i++;return n},this.compatibleBroadcastMAC=function(e){return"FF:FF:FF:FF:FF:FF"===e},this.getConnectorPos=function(e){return a.indexOf(e)},this.getIpMode=function(){return i},this.getSenderConnectorForMAC=function(e){var t=null;return t=e in d?a[d[e]]:t},this.findConnector=function(e){for(var t=null,n=0;null===t&&n<a.length;)a[n].id===e&&(t=a[n]),n++;return t},this.getPerformNAT=function(){return o},this.setPerformNAT=function(e){o=e,l.setPerformNAT(e)},l=new TrafficManager(g,t,o),u=new GatewayManager(g),n===MACMODE_SHARED&&p(),i===IPMODE_SHARED&&v()},Connector=function(i){this.id=getNextID();var i=i,t=null,n=this;this.save=function(){var e={version:1};return e.id=this.id,e},this.load=function(e){this.id=e.id},this.setLink=function(e){t=e},this.getLink=function(){return t},this.send=function(e){null!=t&&e.canSend()&&t.addMessage(n,e)},this.receive=function(e){i.getTrafficManager().proccess(this,e)},this.getConnectable=function(){return i},this.isConnected=function(){return null!==t},this.getConnectedConnector=function(){var e=null;return e=this.isConnected()?t.getConnector1()!==this?t.getConnector1():t.getConnector2():e},this.getDescription=function(){var e="",t=i.getConnectorPos(this);"router"===i.getOwner().getType()&&(e+=t===ROUTER_LAN?"LAN":"WAN",e+=": ");t=i.getIPInfo(t);return null!==t&&null!==t.getIPv4()&&(e+=t.getIPv4()),e},this.whoHas=function(e){var t=i.getConnectorPos(this),n=i.getIPInfo(t);return null!==n&&n.getIPv4()===e?i.getMAC(t):i.findMACforIP(e,this)},this.getIPInfo=function(){var e=null;switch(i.getIpMode()){case IPMODE_NOIP:e=null;break;case IPMODE_UNIQUE:var t=i.getConnectorPos(this),e=i.getIPInfo(t);break;case IPMODE_SHARED:e=i.getIPInfo(0)}return e},i.addConnector(n)};function requestDHCPInfoCommand(e){network.getElement(e).getApp("DHCPClient").requestInfo()}var DHCPClient=function(t){var n=null,t=t;this.save=function(){var e={version:1};return e.id=this.getId(),e.ifacepos=t,e},this.load=function(e){},this.getId=function(){return"DHCPClient"},this.requestInfo=function(){var e={type:"request",description:"DHCP: request"},e=new Message("tcp",n.getConnectable().getIPInfo(t).getIPv4(),"255.255.255.255",n.getConnectable().getMAC(t),"FF:FF:FF:FF:FF:FF",getDinamycPort(),67,e,images[IMAGE_ENVELOPEDHCP]);n.getConnectable().getTrafficManager().registerApplication(this,e.getOrigPort(),!1),n.getConnectable().getConnector(t).send(e)},this.receiveMessage=function(e){n.getConnectable().getIPInfo(t).setIPv4(e.getData().ipv4),n.getConnectable().getIPInfo(t).setDNS1(e.getData().dns1),n.getConnectable().getIPInfo(t).setDNS2(e.getData().dns2),n.getConnectable().getGatewayManager().addGatewayInfo("0.0.0.0","0.0.0.0",e.getData().gateway),n.getConnectable().getIPInfo(t).setNetmask(e.getData().netmask),n.getConnectable().getIPInfo(t).setStatic(!1)},this.setOwner=function(e){n=e},this.getIfacepos=function(){return t},this.getMenuEntries=function(){var e=[];return e[0]={},e[0].img="img/64/envelope-DHCP.png",e[0].text="Request DHCP info",e[0].js="requestDHCPInfoCommand("+n.id+");",e},this.getAppDescription=function(){return""}};function editDHCPServerInfo(e){createBkDiv(),createDHCPServerInfoDiv(e)}function createDHCPServerInfoDiv(e){var t=network.getElement(e).getApp("DHCPServer"),n=(document.createElement("div"),'<input type="button" id="upload" value="'+_("Save")+'" onclick="saveDHCPServerData('+e+');" />');n+='<input type="button" id="cancel" value="'+_("Cancel")+'" onclick="cancelDHCPServerData();" />';e=new UIWindow("divdhcpserverinfo","DHCP Server",400,200,!1,1);e.setContent(t.getAppController()),e.setControls(n),e.render()}function saveDHCPServerData(e){var t=network.getElement(e),n=document.getElementById("dhcpinitial").value,i=document.getElementById("dhcpend").value,o=document.getElementById("dhcpgw").value,r=document.getElementById("dhcpdns1").value,e=document.getElementById("dhcpdns2").value;t.getApp("DHCPServer").setData(n,i,o,r,e),removeBodyDiv("divbk"),uimanager.getWindow("divdhcpserverinfo").dispose()}function cancelDHCPServerData(){removeBodyDiv("divbk"),uimanager.getWindow("divdhcpserverinfo").dispose()}var DHCPServer=function(r){var a=null,r=r,s=100,l=200,c=null,d=null,u=null,g=[],f=[];this.save=function(){var e={version:1};return e.id=this.getId(),e.ifacepos=r,e.initial=s,e.end=l,e.gateway=c,e.dns1=d,e.dns2=u,e},this.load=function(e){s=e.initial,l=e.end,c=e.gateway,d=e.dns1,u=e.dns2},this.getId=function(){return"DHCPServer"},this.setData=function(e,t,n,i,o){s=e,l=t,c=n,d=i,u=o},this.receiveMessage=function(e){var t,n;"request"===e.getData().type&&null!==a.getConnectable().getIPInfo(r).getIPv4()&&(t=e.getOriginMAC(),(n=null)===(t=n=t in f?g.indexOf(f[t]):n)&&(t=function(e){for(var t=s,n=!1;!n;)t in g?t++:n=!0;var i=a.getConnectable().getIPInfo(r).getIPv4().split("."),o=i[0]+"."+i[1]+"."+i[2]+".";return(i={}).mac=e,i.ipv4=o+t,g[t]=i,f[e]=i,t}(e.getOriginMAC())),(n={}).ipv4=g[t].ipv4,n.dns1=d,n.dns2=u,n.gateway=c,n.netmask=a.getConnectable().getIPInfo(r).getNetmask(),n.description="DHCP: offer",n=new Message("tcp",a.getConnectable().getIPInfo(r).getIPv4(),g[t].ipv4,a.getConnectable().getMAC(r),e.getOriginMAC(),67,e.getOrigPort(),n,images[IMAGE_ENVELOPEDHCP]),a.getConnectable().getConnector(r).send(n))},this.setOwner=function(e){a=e},this.getIfacepos=function(){return r},this.getAppController=function(){network.getPosForElement(a);return result="<label for='dhcpinitial'>"+_("Initial:")+"</label>     <input type='text' id='dhcpinitial' value='"+s+"' /><br/>     <label for='dhcpend'>"+_("Final:")+"</label>     <input type='text' id='dhcpend' value='"+l+"' /><br/>     <label for='dhcpgw'>"+_("Gateway:")+"</label>     <input type='text' id='dhcpgw' value='"+(null===c?"":c)+"' /><br/>     <label for='dhcpdns1'>"+_("DNS 1:")+"</label>     <input type='text' id='dhcpdns1' value='"+(null===d?"":d)+"' /><br/>     <label for='dhcpdns2'>"+_("DNS 2:")+"</label>     <input type='text' id='dhcpdns2' value='"+(null===u?"":u)+"' /><br/>     ",result},this.getMenuEntries=function(){var e=[];return e[0]={},e[0].img="img/64/envelope-DHCP.png",e[0].text="Edit DHCP server info",e[0].js="editDHCPServerInfo("+a.id+");",e},this.getAppDescription=function(){var e="DNS Server\n";return e+="Ini: "+s+"/End: "+l,e+="/Gateway: "+(null===c?"- ":c),e+=" /DNS 1: "+(null===d?"- ":d),e+=" /DNS 2: "+(null===u?"- ":u)}};function createDNSLookup(e){createBkDiv(),createDNSLookupDiv(e)}function createDNSLookupDiv(e){var t=network.getElement(e).getApp("DNSClient"),n='<input type="button" id="upload" value="'+_("Lookup")+'" onclick="requestDNSLookup('+e+');" />  <input type="button" id="cancel" value="'+_("Cancel")+'" onclick="cancelDNSLookup();" />',e=new UIWindow("divdnslookup","DNS lookup",400,200,!1,1);e.setContent(t.getAppController()),e.setControls(n),e.render()}function cancelDNSLookup(){uimanager.getWindow("divdnslookup").dispose(),removeBodyDiv("divbk")}function requestDNSLookup(e){var t=network.getElement(e),e=document.getElementById("dnsclientdomain").value;t.getApp("DNSClient").DNSLookup(e),uimanager.getWindow("divdnslookup").dispose(),removeBodyDiv("divbk")}var DNSClient=function(i){var o=null,i=i,n=[];this.save=function(){var e={version:1};return e.id=this.getId(),e.ifacepos=i,e},this.load=function(e){},this.getId=function(){return"DNSClient"},this.DNSLookup=function(e){var t,n;null===o.getConnectable().getIPInfo(i).getIPv4()||null!==(t=o.getConnectable().getDstMAC(o.getConnectable().getIPInfo(i).getDNS1()))&&((n={}).domain=e,n.type="lookup",n.description="Lookup: "+e,n=new Message("tcp",o.getConnectable().getIPInfo(i).getIPv4(),o.getConnectable().getIPInfo(i).getDNS1(),o.getConnectable().getMAC(i),t,getDinamycPort(),53,n,images[IMAGE_ENVELOPEDNS]),o.getConnectable().getTrafficManager().registerApplication(this,n.getOrigPort(),!1),o.getConnectable().getConnector(i).send(n))},this.receiveMessage=function(e){null!==e.getData().ip&&(n[e.getData().domain]=e.getData().ip)},this.setOwner=function(e){o=e},this.getIfacepos=function(){return i},this.getIp=function(e){var t=null;return t=e in n?n[e]:t},this.getAppController=function(){network.getPosForElement(o);return"<p>         <label for='dnsclientdomain' >"+_("Domain:")+"</label>         <input type='text' id='dnsclientdomain' />         </p>"},this.getMenuEntries=function(){var e=[];return e[0]={},e[0].img="img/64/envelope-DNS.png",e[0].text="DNS lookup",e[0].js="createDNSLookup("+o.id+");",e},this.getAppDescription=function(){return""}};function setupDNSServerConfig(e){createBkDiv(),createDNSServerConfigDiv(e)}function createDNSServerConfigDiv(e){var t=network.getElement(e).getApp("DNSServer"),n=[_("Domain"),_("IP")],i=t.getAppControllerData(),n=new UITable(n,i,"dnstable"),i='<input type="button" id="upload" value="'+_("Save")+'" onclick="saveDNSServerConfig('+e+",'"+n.getId()+'\');" />  <input type="button" id="cancel" value="'+_("Cancel")+'" onclick="cancelDNSServerConfig(\''+n.getId()+"');\" />",e=new UIWindow("divdnsserverconfig","DNS Server",400,400,!1,1);e.setContent(t.getAppController()),e.setControls(i),e.render(),n.render()}function saveDNSServerConfig(e,t){var n=uitables[t].getData(),i=network.getElement(e).getApp("DNSServer");i.resetDNSTable();for(var o=0;o<n.length;o++)i.setEntry(n[o][0],n[o][1]);e=document.getElementById("forwarder").value;i.setForwarder(e),uimanager.getWindow("divdnsserverconfig").dispose(),removeBodyDiv("divbk"),uitables[t].dispose()}function cancelDNSServerConfig(e){uimanager.getWindow("divdnsserverconfig").dispose(),removeBodyDiv("divbk"),uitables[e].dispose()}var DNSServer=function(r){var a=null,r=r,s=[],l=null,c=[],i=this;function d(e){var t,n=a.getConnectable().getDstMAC(l);null!==n&&((t={}).domain=e.getData().domain,t.type="lookup_forward",t.description="Lookup Fwd: "+e.getData().domain,t.originId=e.getId(),t=new Message("tcp",a.getConnectable().getIPInfo(r).getIPv4(),l,a.getConnectable().getMAC(r),n,getDinamycPort(),53,t,images[IMAGE_ENVELOPEDNS]),c[t.getId()]={},c[t.getId()].domain=e.getData().domain,c[t.getId()].ip=e.getOriginIP(),c[t.getId()].port=e.getOrigPort(),c[t.getId()].originId=e.getId(),a.getConnectable().getTrafficManager().registerApplication(i,t.getOrigPort(),!1),a.getConnectable().getConnector(r).send(t))}this.save=function(){var e,t={version:1};for(e in t.id=this.getId(),t.ifacepos=r,t.dnstable=[],t.forwarder=l,s){var n={};n.domain=e,n.ip=s[e],t.dnstable.push(n)}return t},this.load=function(e){e.forwarder&&(l=e.forwarder);for(var t=0;t<e.dnstable.length;t++)this.setEntry(e.dnstable[t].domain,e.dnstable[t].ip)},this.getId=function(){return"DNSServer"},this.getPort=function(){return port},this.resetDNSTable=function(){s=[]},this.setEntry=function(e,t){s[e]=t},this.deleteDNSEntry=function(e){e in s&&delete s[e]},this.receiveMessage=function(e){var t,n,i,o;"lookup"===e.getData().type&&e.getData().domain?(i=!1,(o={}).domain=(n=e).getData().domain,o.type="response",o.domain in s?(o.ip=s[o.domain],o.description="Response: "+o.ip,i=!0):null!==l?d(n):(o.ip=null,o.description="Response: not found",i=!0),i&&(o=new Message("tcp",a.getConnectable().getIPInfo(r).getIPv4(),n.getOriginIP(),a.getConnectable().getMAC(r),a.getConnectable().getDstMAC(n.getOriginIP()),53,n.getOrigPort(),o,images[IMAGE_ENVELOPEDNS]),a.getConnectable().getConnector(r).send(o))):"lookup_forward"===e.getData().type&&e.getData().domain?(i=!1,(n={}).domain=(o=e).getData().domain,n.type="response_forward",n.originId=o.getId(),n.domain in s?(n.ip=s[n.domain],n.description="Response Fwd: "+n.ip,i=!0):null!==l?d(o):(n.ip=null,n.description="Response Fwd: not found",i=!0),i&&(n=new Message("tcp",a.getConnectable().getIPInfo(r).getIPv4(),o.getOriginIP(),a.getConnectable().getMAC(r),a.getConnectable().getDstMAC(o.getOriginIP()),53,o.getOrigPort(),n,images[IMAGE_ENVELOPEDNS]),a.getConnectable().getConnector(r).send(n))):"response_forward"===e.getData().type&&(t=e).getData().originId in c&&((e={}).domain=t.getData().domain,e.type="response_forward",e.originId=c[t.getData().originId].originId,null!==e.domain?(e.ip=t.getData().ip,e.description="Response Fwd: "+e.ip):(e.ip=null,e.description="Response Fwd: not found"),e=new Message("tcp",a.getConnectable().getIPInfo(r).getIPv4(),c[t.getData().originId].ip,a.getConnectable().getMAC(r),a.getConnectable().getDstMAC(c[t.getData().originId].ip),53,c[t.getData().originId].port,e,images[IMAGE_ENVELOPEDNS]),delete c[t.getData().originId],a.getConnectable().getConnector(r).send(e))},this.setOwner=function(e){a=e},this.getIfacepos=function(){return r},this.getAppController=function(){network.getPosForElement(a);return result="<table id='dnstable' style='font-size:0.8em;'></table>",result+="<p>",result+="<label for='forwarder'>"+_("Forwarder:")+"</label>",result+="<input type='text' id='forwarder' value='"+(null===l?"":l)+"' />",result+="</p>",result},this.getMenuEntries=function(){var e=[];return e[0]={},e[0].img="img/64/envelope-DNS.png",e[0].text="DNS server config",e[0].js="setupDNSServerConfig("+a.id+");",e},this.getAppControllerData=function(){var e,t=[];for(e in s){var n=[];n.push(e),n.push(s[e]),t.push(n)}return t},this.setForwarder=function(e){l=e},this.getAppDescription=function(){return"DNS Server"}},Drawable=function(e){this.id=getNextID();var o=0,r=0,a=null,s=e,n=new UIRectangle(null,null,this,0,0,0,0,0,!1);uimanager.addClickable(n);var t=[];function i(){if(null!==a)for(var e=0;e<t.length;e++)t[e].drawableChanged()}this.save=function(){var e={version:1};return e.id=this.id,e.X=o,e.Y=r,e},this.load=function(e){o=e.X,r=e.Y,this.id=e.id,i()},this.setPosition=function(e,t){o=e,r=t,null!==a&&n.setCoords(o,r,a.width,a.height,0),i()},this.getX=function(){return o},this.getY=function(){return r},this.getCenterX=function(){return o+a.width/2},this.getCenterY=function(){return r+a.height/2},this.setImage=function(e){null!==(a=e)&&n.setCoords(o,r,a.width,a.height,0),i()},this.draw=function(e){e.save(),e.translate(o,r),e.drawImage(a,0,0),function(e){var t=8;e.font="8pt",e.fillStyle="black";for(var n=s.getStrInfo().split("\n"),i=0;i<n.length;i++)e.fillText(n[i],0,a.height+t),t+=8;DEBUG&&e.fillText("X: "+o+" - Y: "+r,0,a.height+t)}(e),e.restore()},this.getOwner=function(){return s},this.getRect=function(){var e={};return e.x=o,e.y=r,e.width=a.width,e.height=a.height,e},this.addObserver=function(e){t.push(e)},this.deleteObserver=function(e){e=t.indexOf(e);t.splice(e,1)},this.dispose=function(){uimanager.removeClickable(n)}};function createGatewaysDiv(e){var t=network.getElement(e),n=[_("Network"),_("Mask"),_("Gateway")],i=t.getConnectable().getGatewayManager().getControllerData(),n=new UITable(n,i,"gwtable"),i='<input type="button" id="upload" value="'+_("Save")+'" onclick="saveGWConfig('+e+",'"+n.getId()+'\');" />  <input type="button" id="cancel" value="'+_("Cancel")+'" onclick="cancelGWConfig(\''+n.getId()+"');\" />",e=new UIWindow("divgwconfig",_("Gateway Configuration"),700,400,!1,1);e.setContent(t.getConnectable().getGatewayManager().getController()),e.setControls(i),e.render(),n.render()}function editGateways(e){createBkDiv(),createGatewaysDiv(e)}function cancelGWConfig(e){uimanager.getWindow("divgwconfig").dispose(),removeBodyDiv("divbk"),uitables[e].dispose()}function saveGWConfig(e,t){var n=network.getElement(e);n.getConnectable().getGatewayManager().purgeGatewayInfo();for(var i=uitables[t].getData(),o=0;o<i.length;o++){var r=""===(r=i[o][0])?"0.0.0.0":r,a=""===(a=i[o][1])?"0.0.0.0":a,s=i[o][2];n.getConnectable().getGatewayManager().addGatewayInfo(r,a,s)}uimanager.getWindow("divgwconfig").dispose(),removeBodyDiv("divbk"),uitables[t].dispose()}var GatewayManager=function(e){var a=[],t=this,s=null;this.addGatewayInfo=function(e,t,n){var i,o;isValidIPv4(e)&&(null===n||isValidIPv4(n))&&(i="0.0.0.0"===e,(o={}).dst=e,o.gw=n,i?(o.mask="0.0.0.0",s=o):(o.mask=t,a.push(o)))},this.save=function(){var e={};return e.defaultgw=s.gw,e.gateways=a,e},this.load=function(e){if(null!==e){this.addGatewayInfo("0.0.0.0","0.0.0.0",e.defaultgw);for(var t=0;t<e.gateways.length;t++)this.addGatewayInfo(e.gateways[t].dst,e.gateways[t].mask||"255.255.255.0",e.gateways[t].gw)}},this.purgeGatewayInfo=function(){a=[],s.gw=null},this.getController=function(){return"<table style='width:100%;' id='gwtable'></table>"},this.getControllerData=function(){var e=[],t=[];null!==s.gw&&(t[0]=s.dst,t[1]=s.mask,t[2]=s.gw,e.push(t));for(var n=0;n<a.length;n++){var i=[];i[0]=a[n].dst,i[1]=a[n].mask,i[2]=a[n].gw,e.push(i)}return e},this.getGatewayForIP=function(e){var t=null;if(isValidIPv4(e)){for(var n=ipStringToInt(e),i=0;null===t&&i<a.length;){var o=ipStringToInt(a[i].dst),r=ipStringToInt(a[i].mask);(o&r)==(n&r)?t=a[i].gw:i++}null===t&&(t=s.gw)}return t},this.getGatewayDescription=function(){var e="";null!==s.gw&&(e+="Dst: "+s.dst+" / ",e+="Mask: "+s.mask+" / ",e+="GW: "+s.gw,e+="\n");for(var t=0;t<a.length;t++)e+="Dst: "+a[t].dst+" / ",e+="Mask: "+a[t].mask+" / ",e+="GW: "+a[t].gw,t<a.length-1&&(e+="\n");return e},t.addGatewayInfo("0.0.0.0","0.0.0.0",null)},MACMODE_SHARED=0,MACMODE_UNIQUE=1,IPMODE_SHARED=0,IPMODE_UNIQUE=1,IPMODE_NOIP=2,IMAGE_SWITCH=0,IMAGE_ROUTER=1,IMAGE_COMPUTER=2,IMAGE_SERVERWEB=3,IMAGE_SERVERDNS=4,IMAGE_SERVERDHCP=5,IMAGE_ENVELOPEDHCP=6,IMAGE_ENVELOPEDNS=7,IMAGE_ENVELOPEHTTP=8,IMAGE_ENVELOPEICMP=9,REFRESH_INTERVAL=1e3/60,LINE_SELECT_TOLERANCE=2,ROUTER_WAN=0,ROUTER_LAN=1,DEBUG=!1,network=null,images=null,uimanager=null,lastuseddinamycport=1024,lastusedid=0;function getDinamycPort(){return++lastuseddinamycport}function getNextID(){return++lastusedid}var NetworkSimulator={initialdata:null,verbose:!1};function editNameGroup(e){createBkDiv(),createNameGroupDiv(e)}function createNameGroupDiv(e){var t=network.getElement(e),n="<p>";n+='<label for="nametxt">'+_("Name:")+"</label>",n+='<input type="text" id="nametxt" value="'+(null===t.getName()?"":t.getName())+'" /><br/>',n+='<label for="grouptxt">'+_("Group:")+"</label>",n+='<input type="text" id="grouptxt" value="'+(null===t.getGroup()?"":t.getGroup())+'" />',n+="</p>";t='<p>  <input type="button" id="save" value="'+_("Save")+'" onclick="saveNameGroup('+e+');" />  <input type="button" id="cancel" value="'+_("Exit")+'" onclick="cancelNameGroup();" />  </p>',e=new UIWindow("divnamegroup",_("Edit name / group"),400,150,!1,1);e.setContent(n),e.setControls(t),e.render()}function cancelNameGroup(){uimanager.getWindow("divnamegroup").dispose(),removeBodyDiv("divbk")}function saveNameGroup(e){var t=network.getElement(e),n=document.getElementById("nametxt").value,e=""===(e=document.getElementById("grouptxt").value)?null:e;t.setName(n),t.setGroup(e),uimanager.getWindow("divnamegroup").dispose(),removeBodyDiv("divbk")}function networkDiagnostics(e){createBkDiv(),createDiagnosticsDiv(e)}function createDiagnosticsDiv(e){var t=network.getElement(e),n=(document.createElement("div"),"<p>");n+='<select id="ifacepos">';for(var i=0;i<t.getConnectable().getConnectorNumber();i++)n+='<option value="'+i+'">'+t.getConnectorDesc(i)+"</option>";n+="</select>",n+='<input type="text" id="diagnosticstxt" />',n+="</p>",n+="<p>",n+='<input type="button" id="ping" value="Ping" onclick="diagnosticsPing('+e+')" />',n+='<input type="button" id="traceroute" value="Trace Route" onclick="diagnosticsTraceroute('+e+')" />',n+="</p>",n+='<div style="width:100%;height:250px;text-align:left;font-size:0.8em;font-style:italic;overflow-y:scroll;" id="diagnosticsconsole" >',n+=t.getConnectable().getTrafficManager().getDiagnosticsInfo(),n+="</div>";var o='<p><input type="button" id="cancel" value="'+_("Exit")+'" onclick="cancelDiagnostics();" /></p>',e=new UIWindow("divdiagnostics","Network diagnostics",400,400,!1,1);e.setContent(n),e.setControls(o),e.render()}function diagnosticsPing(e){var t=network.getElement(e),n=document.getElementById("diagnosticstxt").value,e=document.getElementById("ifacepos").value;t.getConnectable().getTrafficManager().ping(n,e)}function diagnosticsTraceroute(e){var t=network.getElement(e),n=document.getElementById("diagnosticstxt").value,e=document.getElementById("ifacepos").value;t.getConnectable().getTrafficManager().traceroute(n,e)}function cancelDiagnostics(){removeBodyDiv("divbk"),uimanager.getWindow("divdiagnostics").dispose()}function editNATTable(e){createBkDiv(),createNATDiv(e)}function createNATDiv(e){var t=network.getElement(e),n=(document.createElement("div"),[_("Input interface"),_("WAN Port"),_("LAN Port"),_("IP")]),i=t.getConnectable().getTrafficManager().getNATData(),n=new UITable(n,i,"nattable"),i="";"router"===t.getType()&&(i+="<p>",i+="<input type='checkbox' id='performNAT' "+(t.getConnectable().getPerformNAT()?"checked='checked'":"")+" />",i+="<label for='performNAT'>"+_("Gateway mode (uses NAT).")+"</label>",i+="</p>"),i+='<table id="nattable" style="font-size:0.8em;width:100%;"></table>';t='<p>  <input type="button" id="upload" value="'+_("Save")+'" onclick="saveNATConfig('+e+",'"+n.getId()+'\');" />  <input type="button" id="cancel" value="'+_("Cancel")+'" onclick="cancelNATConfig(\''+n.getId()+"');\" />  </p>",e=new UIWindow("divnatconfig","Edit NAT",700,400,!1,1);e.setContent(i),e.setControls(t),e.render(),n.render()}function cancelNATConfig(e){uimanager.getWindow("divnatconfig").dispose(),removeBodyDiv("divbk"),uitables[e].dispose()}function saveNATConfig(e,t){var n=network.getElement(e);n.getConnectable().getTrafficManager().removeFixedNATData();for(var i=uitables[t].getData(),o=0;o<i.length;o++)n.getConnectable().getTrafficManager().addNATEntry(i[o][2],i[o][1],i[o][3],i[o][0],!0);e=document.getElementById("performNAT");null!==e&&n.getConnectable().setPerformNAT(e.checked),uimanager.getWindow("divnatconfig").dispose(),removeBodyDiv("divbk"),uitables[t].dispose()}function editIpInfo(e,t){createBkDiv(),createIpDiv(e,t)}function createIpDiv(e,t){var n=network.getElement(e).getConnectable().getIPInfo(t),i=document.createElement("div"),o=window.innerWidth/2-200,r=window.innerHeight/2-75,a=null!==n.getIPv4()?n.getIPv4():"",s=null!==n.getNetmask()?n.getNetmask():"255.255.255.0",l=null!==n.getDNS1()?n.getDNS1():"",n=null!==n.getDNS2()?n.getDNS2():"";i.setAttribute("style","position:absolute;top:"+r+"px;left:"+o+"px;z-index:110;background-color:white;width:400px;height:150px;border-radius:10px;border:1px solid;padding:10px;text-align:center;"),i.setAttribute("id","divipinfo");i='<label for="ip">'+_("IP Address:")+"</label>";i+='<input id="ip" type="text" value="'+a+'" /><br/>',i+='<label for="nm">'+_("Network Mask:")+"</label>",i+='<input id="nm" type="text" value="'+s+'" /><br/>',i+='<label for="dns1">'+_("DNS 1:")+"</label>",i+='<input id="dns1" type="text" value="'+l+'" /><br/>',i+='<label for="dns2"'+_(">DNS 2:")+"</label>",i+='<input id="dns2" type="text" value="'+n+'" /><br/>';e='<p>  <input type="button" id="upload" value="'+_("Save")+'" onclick="saveIpInfo('+e+","+t+');" />  <input type="button" id="cancel" value="'+_("Cancel")+'" onclick="cancelIpInfo();" />  </p>',t=new UIWindow("divipinfo","Edit IP Info",400,150,!1,1);t.setContent(i),t.setControls(e),t.render()}function saveIpInfo(e,t){var n=network.getElement(e),i=""===(i=document.getElementById("ip").value)?null:i,o=""===(o=document.getElementById("nm").value)?null:o,r=""===(r=document.getElementById("dns1").value)?null:r,e=""===(e=document.getElementById("dns2").value)?null:e;n.getConnectable().getIPInfo(t).setIPv4(i),n.getConnectable().getIPInfo(t).setNetmask(o),n.getConnectable().getIPInfo(t).setDNS1(r),n.getConnectable().getIPInfo(t).setDNS2(e),n.getConnectable().getIPInfo(t).setStatic(!0),uimanager.getWindow("divipinfo").dispose(),removeBodyDiv("divbk")}function cancelIpInfo(){uimanager.getWindow("divipinfo").dispose(),removeBodyDiv("divbk")}var Host=function(type,ports){this.id=getNextID();var type=type,connectable=null,drawable=null,_self=this,ports=ports,menu=null,name=type+" "+this.id,group=null,apps=[];function init(){switch(type){case"router":connectable=new Connectable(_self,MACMODE_UNIQUE,IPMODE_UNIQUE,!0,!0);break;case"switch":connectable=new Connectable(_self,MACMODE_SHARED,IPMODE_NOIP,!1,!1);break;default:connectable=new Connectable(_self,MACMODE_UNIQUE,IPMODE_UNIQUE,!0,!1)}for(var e=0;e<ports;e++)new Connector(connectable);(drawable=new Drawable(_self)).addObserver(_self),menu=new UIMenu(name,0,0,!1),addStaticMenu(),uimanager.addMenu(menu)}function addStaticMenu(){if(menu.addEntry("img/64/delete.png","Delete element","deleteSelected();"),menu.addEntry("img/64/edit.png","Edit Name / Group","editNameGroup("+_self.id+");"),menu.addEntry("img/64/link.png","Create Link","createLinkAction();"),connectable.getIpMode()!==IPMODE_NOIP&&(menu.addEntry("img/64/inspect.png","Network diagnostics","networkDiagnostics("+_self.id+");"),menu.addEntry("img/64/edit.png","Edit Gateways","editGateways("+_self.id+");")),connectable.getIpMode()===IPMODE_UNIQUE)for(var e=0;e<connectable.getConnectorNumber();e++)menu.addEntry("img/64/edit.png","Edit IP Info - "+_self.getConnectorDesc(e),"editIpInfo("+_self.id+","+e+");");"router"===type&&menu.addEntry("img/64/edit.png","Edit NAT table","editNATTable("+_self.id+");")}function redoMenu(){for(var e in menu.purge(),menu.setDescription(name),addStaticMenu(),apps)for(var t=apps[e].app.getMenuEntries(),n=0;n<t.length;n++)menu.addEntry(t[n].img,t[n].text,t[n].js)}this.save=function(){var e,t={version:1};for(e in t.id=this.id,t.type=type,t.drawable=drawable.save(),t.connectable=connectable.save(),t.ports=ports,t.apps=[],t.name=name,t.group=group,apps){var n={};n.app=apps[e].app.save(),n.port=apps[e].port,n.fixed=apps[e].fixed,n.type=e,n.ifacepos=apps[e].app.getIfacepos(),t.apps.push(n)}return t},this.load=function(data){switch(this.id=data.id,type=data.type,drawable.load(data.drawable),type){case"computer":drawable.setImage(network.getImages()[IMAGE_COMPUTER]);break;case"dhcpserver":drawable.setImage(network.getImages()[IMAGE_SERVERDHCP]);break;case"dnsserver":drawable.setImage(network.getImages()[IMAGE_SERVERDNS]);break;case"httpserver":drawable.setImage(network.getImages()[IMAGE_SERVERWEB]);break;case"router":drawable.setImage(network.getImages()[IMAGE_ROUTER]);break;case"switch":drawable.setImage(network.getImages()[IMAGE_SWITCH])}if(connectable.load(data.connectable),data.apps)for(var i=0;i<data.apps.length;i++){var app=eval("new "+data.apps[i].type+"("+data.apps[i].ifacepos+")");app.load(data.apps[i].app),this.addApp(app,data.apps[i].port,data.apps[i].fixed)}data.name&&this.setName(data.name),data.group&&(group=data.group),redoMenu()},this.setName=function(e){name=e,redoMenu()},this.setGroup=function(e){group=e},this.getName=function(){return name},this.getGroup=function(){return group},this.getConnectorDesc=function(e){var t=_("Interface ")+e;return t="router"===type?e===ROUTER_WAN?"WAN":"LAN":t},this.drawableChanged=function(){var e=drawable.getRect();menu.setPos(e.x+e.width,e.y)},this.addApp=function(e,t,n){apps[e.getId()]={},apps[e.getId()].app=e,apps[e.getId()].port=t,apps[e.getId()].fixed=n,e.setOwner(_self),n&&connectable.getTrafficManager().registerApplication(e,t,!0),redoMenu()},this.getAppNames=function(e){return Object.keys(apps)},this.getApp=function(e){var t=null;return t=e in apps?apps[e].app:t},this.getConnectable=function(){return connectable},this.getDrawable=function(){return drawable},this.getType=function(){return type},this.getVerboseStr=function(e,t){if(result="",result+="Network Mask: "+(null===e.getIPInfo(t).getNetmask()?"-":e.getIPInfo(t).getNetmask()),result+="\n",result+="DNS 1: "+(null===e.getIPInfo(t).getDNS1()?"-":e.getIPInfo(t).getDNS1()),result+="\n",result+="DNS 2: "+(null===e.getIPInfo(t).getDNS2()?"-":e.getIPInfo(t).getDNS2()),null!==e.getGatewayManager()&&(result+="\n",result+=e.getGatewayManager().getGatewayDescription()),null!==apps)for(var n=this.getAppNames(),t=0;t<n.length;t++){var i=this.getApp(n[t]);result+=i.getAppDescription()}return result},this.getStrInfo=function(){if(result=name,connectable.getIpMode()===IPMODE_UNIQUE)for(var e=0;e<connectable.getConnectorNumber();e++)result+="\n",result+=this.getConnectorDesc(e),result+=": ",result+=null===connectable.getIPInfo(e).getIPv4()?"-":connectable.getIPInfo(e).getIPv4(),1==NetworkSimulator.verbose&&(result+="\n",result+=this.getVerboseStr(connectable,e));else connectable.getIpMode()===IPMODE_SHARED&&(result+="\n",result+=_("IP: "),result+=": ",result+=null===connectable.getIPInfo(0).getIPv4()?"-":connectable.getIPInfo(0).getIPv4(),1==NetworkSimulator.verbose&&(result+="\n",result+=this.getVerboseStr(connectable,0)));return result},this.getMenu=function(){return menu},this.dispose=function(){menu.getVisible()&&menu.hide(),uimanager.deleteMenu(menu),drawable.dispose()},init()};function viewWebBrowser(e){createBkDiv();var t=network.getElement(e).getApp("HTTPClient"),n='<input type="button" id="close" value="'+_("Close")+'" onclick="closeWebBrowser();" />',e=new UIWindow("divhttpclient","HTTP Client (Browser)",400,400,!1,1);e.setContent(t.getAppController()),e.setControls(n),e.render()}function closeWebBrowser(){removeBodyDiv("divbk"),uimanager.getWindow("divhttpclient").dispose()}function requestHTTPWebSite(e){var t=network.getElement(e).getApp("HTTPClient"),e=document.getElementById("httpclienturl").value;t.requestHTTPWebSite(e)}var HTTPClient=function(r){var a=null,r=r,s=null,t=null,o=null,l=this;function c(){var e=document.getElementById("httpbrowsercontents");null!==e&&(e.innerHTML=l.getBrowserContents())}function d(e,t,n){var i,o;null!==a.getConnectable().getIPInfo(r).getIPv4()&&(s=0,c(),null!==(i=a.getConnectable().getDstMAC(t))&&((o={}).domain=e,o.filename=n,o.ip=t,o.description="GET: "+n,o=new Message("tcp",a.getConnectable().getIPInfo(r).getIPv4(),t,a.getConnectable().getMAC(r),i,getDinamycPort(),80,o,images[IMAGE_ENVELOPEHTTP]),a.getConnectable().getTrafficManager().registerApplication(l,o.getOrigPort(),!1),a.getConnectable().getConnector(r).send(o)))}this.save=function(){var e={version:1};return e.id=this.getId(),e.ifacepos=r,e},this.load=function(e){},this.setOwner=function(e){a=e},this.getOwner=function(){return a},this.getIfacepos=function(){return r},this.getId=function(){return"HTTPClient"},this.resetHTTPServerInfo=function(){domains=[]},this.getMenuEntries=function(){var e=[];return e[0]={},e[0].img="img/64/envelope-HTTP.png",e[0].text="Web browser (HTTP client)",e[0].js="viewWebBrowser("+a.id+");",e},this.getBrowserContents=function(){var e="";switch(s){case 0:e=_("Loading...");break;case 404:e=_("404 - Not found");break;case 200:e=t;break;case 997:e=_("Malformed URL.\n\nUse only 'domain_or_ip/filename.html'.");break;case 998:e=_("DNS client not present.");break;case 999:e=_("Domain not in local DNS cache. Look up first.\n\nIf you already performed a lookup, the domain does not exist.")}return e=e.replace(/\n/g,"<br/>")},this.getAppController=function(){return result="<p>",result+="<input type='text' id='httpclienturl' style='width:80%;' value='"+(null!==o?o:"")+"' /> ",result+="<a href='#' onclick='requestHTTPWebSite(\""+a.id+"\");'>",result+="<img src='img/64/right-arrow.png' style='height:1em;' />",result+="</a>",result+="</p>",result+="<div id='httpbrowsercontents' style='font-style:italic;overflow:scroll;text-align:left;min-height:300px;'>",result+=this.getBrowserContents(),result+="</div>",result},this.requestHTTPWebSite=function(e){var t,n,e=document.getElementById("httpclienturl").value,i=(o=e).split("/",2);2===i.length?(n=null,isValidIPv4(t=i[0])?d(n=i[0],n,i[1]):null===(e=a.getApp("DNSClient"))?(s=998,c()):null===(n=e.getIp(t))?(s=999,c()):d(t,n,i[1])):(s=997,c())},this.receiveMessage=function(e){s=e.getData().code,t=e.getData().contents,c()},this.getAppDescription=function(){return""}};function editHTTPServerInfo(e){createBkDiv(),createHTTPServerInfoDiv1(e)}function createHTTPServerInfoDiv1(e){var t=network.getElement(e).getApp("HTTPServer"),n=[_("Domain")],i=t.getAppControllerData1(),n=new UITable(n,i,"httptable");n.setSecondary(!0,"editDomainHTTPServerInfo"),n.setParam("hostid",e);i='<input type="button" id="upload" value="'+_("Save")+'" onclick="saveHTTPServerData1('+e+",'"+n.getId()+'\');" />  <input type="button" id="cancel" value="'+_("Cancel")+'" onclick="cancelHTTPServerData1(\''+n.getId()+"');\" />",e=new UIWindow("divhttpserverinfo","HTTP Server",400,400,!1,1);e.setContent(t.getAppController1()),e.setControls(i),e.render(),n.render()}function createHTTPServerInfoDiv1back(e,t){var n=network.getElement(e).getApp("HTTPServer"),i=uitables[t].getParam("primaryuitableid"),t=(_("Domain"),uitables[i].getData(),uitables[i]),i='<input type="button" id="upload" value="'+_("Save")+'" onclick="saveHTTPServerData1('+e+",'"+t.getId()+'\');" />  <input type="button" id="cancel" value="'+_("Cancel")+'" onclick="cancelHTTPServerData1(\''+t.getId()+"');\" />",e=new UIWindow("divhttpserverinfo","HTTP Server",400,400,!1,1);e.setContent(n.getAppController1()),e.setControls(i),e.render(),t.render()}function createHTTPServerInfoDiv2(e,t,n){var i=network.getElement(e).getApp("HTTPServer"),o=[_("File")],n=new UITable(o,n,"httpfiletable");n.setSecondary(!0,"editFileHTTPServerInfo"),n.setParam("hostid",e),n.setParam("primaryuitableid",t);t='<input type="button" id="upload" value="'+_("Back")+'" onclick="backHTTPServerData2('+e+",'"+n.getId()+"');\" />",e=new UIWindow("divhttpfileserverinfo","HTTP Domain Files",400,400,!1,1);e.setContent(i.getAppController2()),e.setControls(t),e.render(),n.render()}function createHTTPServerInfoDiv3(e,t,n){var i=uitables[t].getData()[n][1],o=network.getElement(e).getApp("HTTPServer"),t='<input type="button" id="upload" value="'+_("Back")+'" onclick="backHTTPServerData3('+e+",'"+t+"',"+n+');" />',n=new UIWindow("divhttpcontentsserverinfo","HTTP Domain File Edition",400,200,!1,1);n.setContent(o.getAppController3(i)),n.setControls(t),n.render()}function backHTTPServerData3(e,t,n){var i=uitables[t].getData(),o=document.getElementById("httpcontents").value;i[n][1]=o,uimanager.getWindow("divhttpcontentsserverinfo").dispose(),createHTTPServerInfoDiv2(e,uitables[t].getParam("primaryuitableid"),i)}function editFileHTTPServerInfo(e,t){var n=uitables[e].getParam("hostid"),i=uitables[e].getData();1==i[t].length&&(i[t][1]=""),uimanager.getWindow("divhttpfileserverinfo").dispose(),createHTTPServerInfoDiv3(n,e,t)}function editDomainHTTPServerInfo(e,t){var n=uitables[e].getParam("hostid"),i=uitables[e].getData();1==i[t].length&&(i[t][1]=[]);t=i[t][1];uimanager.getWindow("divhttpserverinfo").dispose(),createHTTPServerInfoDiv2(n,e,t)}function backHTTPServerData2(e,t){uimanager.getWindow("divhttpfileserverinfo").dispose(),createHTTPServerInfoDiv1back(e,t)}function saveHTTPServerData1(e,t){var n=uitables[t].getData(),i=network.getElement(e).getApp("HTTPServer");i.resetHTTPServerInfo();for(var o=0;o<n.length;o++){var r=n[o][0];if(i.addDomain(r),1<n[o].length)for(var a=0;a<n[o][1].length;a++){var s=n[o][1][a][0];1===n[o][1][a].length&&(n[o][1][a][1]="");var l=n[o][1][a][1];i.setFileContents(r,s,l)}}uimanager.getWindow("divhttpserverinfo").dispose(),removeBodyDiv("divbk"),uitables[t].dispose()}function cancelHTTPServerData1(e){uimanager.getWindow("divhttpserverinfo").dispose(),removeBodyDiv("divbk"),uitables[e].dispose()}var HTTPServer=function(a){var s=null,a=a,l=[];this.save=function(){var e={version:1};for(domain in e.id=this.getId(),e.ifacepos=a,e.domains=[],l){var t={};for(filename in t.domain=domain,t.files=[],l[domain]){var n={};n.filename=filename,n.contents=l[domain][filename],t.files.push(n)}e.domains.push(t)}return e},this.load=function(e){for(var t=0;t<e.domains.length;t++){var n=e.domains[t].domain;this.addDomain(n);for(var i=0;i<e.domains[t].files.length;i++){var o=e.domains[t].files[i].filename,r=e.domains[t].files[i].contents;this.setFileContents(n,o,r)}}},this.setOwner=function(e){s=e},this.getOwner=function(){return s},this.getIfacepos=function(){return a},this.getId=function(){return"HTTPServer"},this.addDomain=function(e){e in l||(l[e]=[])},this.deleteDomain=function(e){e in l&&delete l[e]},this.setFileContents=function(e,t,n){e in l&&(l[e][t]=n)},this.deleteFile=function(e,t){e in l&&file in l[e]&&delete l[e][t]},this.resetHTTPServerInfo=function(){l=[]},this.getMenuEntries=function(){var e=[];return e[0]={},e[0].img="img/64/envelope-HTTP.png",e[0].text="Edit HTTP server info",e[0].js="editHTTPServerInfo("+s.id+");",e},this.getAppController1=function(){return result="<table id='httptable' style='font-size:0.8em;'></table>",result},this.getAppController2=function(){return result="<table id='httpfiletable' style='font-size:0.8em;'></table>",result},this.getAppController3=function(e){return result="<textarea id='httpcontents' style='font-size:0.8em;width:100%;height:100px;'>",result+=e,result+="</textarea>",result},this.getAppControllerData1=function(){var e,t=[];for(e in l){var n=[];n.push(e);var i,o=[];for(i in l[e]){var r=[];r[0]=i,r[1]=l[e][i],o.push(r)}n.push(o),t.push(n)}return t},this.receiveMessage=function(e){var t=e.getData(),n=t.domain,i=t.filename,o=(t.ip,null),t=null;t=n in l?i in l[n]?(o=200,l[n][i]):(o=404,""):isValidIPv4(n)&&0<(r=Object.keys(l)).length&&i in l[r[0]]?(o=200,l[r[0]][i]):(o=404,"");var r={};r.code=o,r.contents=t,r.description=o+"-"+i;r=new Message("tcp",s.getConnectable().getIPInfo(a).getIPv4(),e.getOriginIP(),s.getConnectable().getMAC(a),s.getConnectable().getDstMAC(e.getOriginIP()),80,e.getOrigPort(),r,images[IMAGE_ENVELOPEHTTP]);s.getConnectable().getConnector(a).send(r)},this.getAppDescription=function(){return"HTTP Server"}},ImageLoader=function(i,o){var i=i,r=[],a=0,o=o;this.getLoadedImages=function(){return this.loadedImages},this.load=function(){!function e(){var t,n;a<i.length?(t=a,a++,n=new Image,r.push(n),n.onload=function(){e()},n.src=i[t]):o(r)}()}};function isValidIPv4(e){var t,n,i,o=!1;return null!==e?4===(i=e.split(".")).length&&(t=parseInt(i[0]),n=parseInt(i[1]),e=parseInt(i[2]),i=parseInt(i[3]),o=NaN!==t&&0<=t&&t<=255&&NaN!==n&&0<=n&&n<=255&&NaN!==e&&0<=e&&e<=255&&NaN!==i&&0<=i&&i<=255):o=!0,o}function ipStringToInt(e){var t=null;return t=null!==e?(e=e.split("."))[0]<<24|e[1]<<16|e[2]<<8|e[3]:t}function ipIntToString(e){return result=null!==e?(e>>24&255)+"."+(e>>16&255)+"."+(e>>8&255)+"."+(255&e):null,result}var IPInfo=function(){var n=null,t=null,i=null,o=null,r=!1;this.save=function(){var e={};return e.IPv4=r?n:null,e.DNS1=r?t:null,e.DNS2=r?i:null,e.netmask=r?o:null,e.static=r,e},this.load=function(e){null!=e&&(n=e.IPv4,t=e.DNS1,i=e.DNS2,o=e.netmask,r=e.static)},this.sameNetwork=function(e){var t=!1;return t=null!==n&&null!==o&&isValidIPv4(e)?(ipStringToInt(e)&o)==(n&o):t},this.setIPv4=function(e){isValidIPv4(e)&&(n=ipStringToInt(e))},this.setNetmask=function(e){isValidIPv4(e)&&(o=ipStringToInt(e))},this.setDNS1=function(e){isValidIPv4(e)&&(t=ipStringToInt(e))},this.setDNS2=function(e){isValidIPv4(e)&&(i=ipStringToInt(e))},this.setStatic=function(e){r=e},this.getIPv4=function(){return ipIntToString(n)},this.getDNS1=function(){return ipIntToString(t)},this.getDNS2=function(){return ipIntToString(i)},this.getNetmask=function(){return ipIntToString(o)},this.getStatic=function(){return r}};function selectLinkConnectors(e,t){createBkDiv(),createLinkConnectorsDiv(e,t)}function getElementConnectorsSelectables(e){for(var t="",n=0;n<e.getConnectable().getConnectorNumber();n++){var i=e.getConnectable().getConnector(n).isConnected()?" disabled='disabled' ":"";t+="<input type='radio' name='link_host_"+e.id+"' value='"+n+"' id='link_host_"+e.id+"_"+n+"' "+i+"/>",t+=e.getConnectorDesc(n),t+="<br/>"}return t}function createLinkConnectorsDiv(e,t){var n=network.getElement(e),i=network.getElement(t),o='<table style="font-size:0.8em;">';o+="<tr><th>"+n.getName()+"</th><th>"+i.getName()+"</th></tr>",o+="<tr>",o+="<td>",o+=getElementConnectorsSelectables(n),o+="</td>",o+="<td>",o+=getElementConnectorsSelectables(i),o+="</td>",o+="</tr>",o+="</table>";e='<p>  <input type="button" id="upload" value="'+_("Save")+'" onclick="saveLinkConnectors('+e+","+t+');" />  <input type="button" id="cancel" value="'+_("Cancel")+'" onclick="cancelLinkConnectors();" />  </p>',t=new UIWindow("divlinkconnectors","Create Link",400,400,!1,1);t.setContent(o),t.setControls(e),t.render()}function saveLinkConnectors(e,t){var n=document.querySelector('input[name="link_host_'+e+'"]:checked'),i=document.querySelector('input[name="link_host_'+t+'"]:checked');null!==n&&null!==i&&(n=n.value,i=i.value,null!==n&&null!==i&&(network.createLink(e,n,t,i),uimanager.getWindow("divlinkconnectors").dispose(),removeBodyDiv("divbk")))}function cancelLinkConnectors(){uimanager.getWindow("divlinkconnectors").dispose(),removeBodyDiv("divbk")}var Link=function(e,t){this.id=getNextID();var i=e,o=t,r=[],n=this,a=null,s=null;function l(e){var t=r[e].orig.getConnectable().getOwner().getDrawable().getCenterX(),n=r[e].orig.getConnectable().getOwner().getDrawable().getCenterY(),i=r[e].dst.getConnectable().getOwner().getDrawable().getCenterX(),o=r[e].dst.getConnectable().getOwner().getDrawable().getCenterY();return{x:t+(i-t)*r[e].pos/100,y:n+(o-n)*r[e].pos/100}}function c(e){for(var t=0;t<r.length;t++){var n=l(t);e.save(),e.translate(n.x,n.y),e.drawImage(r[t].message.getImage(),0,0),function(e,t){var n=8;e.font="8pt",e.fillStyle="black";for(var i=t.getStrInfo().split("\n"),o=0;o<i.length;o++)e.fillText(i[o],0,t.getImage().height+n),n+=8}(e,r[t].message),e.restore()}}function d(){return{x1:i.getConnectable().getOwner().getDrawable().getCenterX(),y1:i.getConnectable().getOwner().getDrawable().getCenterY(),x2:o.getConnectable().getOwner().getDrawable().getCenterX(),y2:o.getConnectable().getOwner().getDrawable().getCenterY()}}this.save=function(){var e={version:1};return e.id=this.id,e.connector1=i.id,e.connector2=o.id,e},this.load=function(e){this.id=e.id},this.drawableChanged=function(){var e=d();a.setCoords(e.x1,e.y1,e.x2,e.y2,0)},this.dispose=function(){uimanager.removeClickable(a),i.getConnectable().getOwner().getDrawable().deleteObserver(n),o.getConnectable().getOwner().getDrawable().deleteObserver(n),s.getVisible()&&s.hide(),uimanager.deleteMenu(s)},this.getConnector1=function(){return i},this.getConnector2=function(){return o},this.delete=function(){i.setLink(null),o.setLink(null)},this.addMessage=function(e,t){var n={pos:0};n.message=t,n.orig=e,n.dst=e===i?o:i,r.push(n)},this.draw=function(e,t){var n=d();e.lineWidth=2,e.strokeStyle=t?"blue":"red",e.beginPath(),e.moveTo(n.x1,n.y1),e.lineTo(n.x2,n.y2),e.stroke(),c(e)},this.update=function(){for(var e=[],t=0;t<r.length;t++)r[t].pos+=AnimationControls.MSG_ADVANCE,r[t].pos<100?e.push(r[t]):r[t].dst.receive(r[t].message);r=e},this.messageHasCoords=function(e,t,n){var i=l(e);return i.x<=t&&t<=i.x+r[e].message.getImage().width&&i.y<=n&&n<=i.y+r[e].message.getImage().height},this.getMessage=function(e){return r[e].message},this.getMessageCount=function(){return r.length},this.hasCoords=function(e,t){var n=d();return distToSegment({x:e,y:t},{x:n.x1,y:n.y1},{x:n.x2,y:n.y2})<LINE_SELECT_TOLERANCE},this.getCenter=function(){var e={},t=d();return e.x=(t.x1+t.x2)/2,e.y=(t.y1+t.y2)/2,e},this.getMenu=function(){return s},function(){i.setLink(n),o.setLink(n);var e=d();a=new UILine(null,null,n,e.x1,e.y1,e.x2,e.y2,0),uimanager.addClickable(a),i.getConnectable().getOwner().getDrawable().addObserver(n),o.getConnectable().getOwner().getDrawable().addObserver(n),(s=new UIMenu("Link",0,0,!1)).addEntry("img/64/delete.png","Delete element","deleteSelected();"),uimanager.addMenu(s)}()},lastMessageId=0;function getNextMessageId(){return++lastMessageId}var Message=function(e,t,n,i,o,r,a,s,l){var c=t,d=n,u=i,g=o,r=r,a=a,f=s,p=l,v=getNextMessageId(),e=e,h=32;this.decreaseTTL=function(){h--},this.canSend=function(){return 0!==h},this.getId=function(){return v},this.getImage=function(){return p},this.getOriginIP=function(){return c},this.setOriginIP=function(e){c=e},this.getOriginMAC=function(){return u},this.setOriginMAC=function(e){u=e},this.getDestinationIP=function(){return d},this.setDestinationIP=function(e){d=e},this.getDestinationMAC=function(){return g},this.setDestinationMAC=function(e){g=e},this.getOrigPort=function(){return r},this.setOrigPort=function(e){r=e},this.getDstPort=function(){return a},this.setDstPort=function(e){a=e},this.getData=function(){return f},this.getType=function(){return e},this.getStrInfo=function(){var e="Src: "+(null===this.getOriginIP()?"-":this.getOriginIP())+"\n";return e+="Dst: "+(null===this.getDestinationIP()?"-":this.getDestinationIP()),f.description&&(e+="\n",e+=f.description),e}};function deleteSelected(){null!==network.getSelected()&&network.getSelected()instanceof Host?confirm("Do you really want to delete the selected element?")&&(network.deleteSelectedElement(),uimanager.selectedElementDeleted()):null!==network.getSelected()&&network.getSelected()instanceof Link&&confirm("Do you really want to delete the selected link?")&&(network.deleteSelectedLink(),uimanager.selectedLineDeleted())}var Network=function(e,t,n,i){var a=[],l=[],o=e,d=t,u=this,g=n,f=i,p=null;function v(e){e.getConnector1().setLink(null),e.getConnector2().setLink(null);var t=l.indexOf(e);l.splice(t,1),e.dispose()}function h(){d.fillStyle="#DDDDDD",d.fillRect(0,0,g,f);for(var e=0;e<l.length;e++)l[e].update(),l[e].draw(d,p===l[e]);for(var t,n=Object.keys(a),e=0;e<n.length;e++)a[n[e]].getDrawable().draw(d);!function(e){for(var t=[],n=Object.keys(a),i=0;i<n.length;i++){var o=a[n[i]];null!==o.getGroup()&&(o.getGroup()in t||(r={minx:1e6,miny:1e6,maxx:0,maxy:0},t[o.getGroup()]=r),r=t[o.getGroup()],o=o.getDrawable().getRect(),r.minx>o.x&&(r.minx=o.x),r.miny>o.y&&(r.miny=o.y),r.maxx<o.x+o.width&&(r.maxx=o.x+o.width),r.maxy<o.y+o.height&&(r.maxy=o.y+o.height))}for(n=Object.keys(t),i=0;i<n.length;i++){var r=t[n[i]];e.strokeStyle="rgba(255,255,255,0.5)",e.lineWidth=4,e.strokeRect(r.minx-10,r.miny-10,r.maxx-r.minx+20,r.maxy-r.miny+20),e.font="16pt",e.fillStyle="rgba(255,255,255,1.0)",e.fillText(n[i],r.minx,r.maxy+20)}}(d),uimanager.render(d),DEBUG&&(d.fillStyle="#000000",t=uimanager.getMousePos(),d.fillText("Mouse coords - X: "+t.X+" - Y: "+t.Y,10,100))}this.init=function(){setInterval(h,REFRESH_INTERVAL)},this.getImages=function(){return o},this.createComputer=function(e,t){c=new Host("computer",1),c.getDrawable().setPosition(e,t),c.getDrawable().setImage(o[IMAGE_COMPUTER]);t=new DHCPClient(0);c.addApp(t,-1,!1);t=new DNSClient(0);c.addApp(t,-1,!1);t=new HTTPClient(0);return c.addApp(t,-1,!1),a[c.id]=c,c.id},this.createDHCPServer=function(e,t){c=new Host("dhcpserver",1),c.getDrawable().setPosition(e,t),c.getDrawable().setImage(o[IMAGE_SERVERDHCP]);t=new DHCPServer(0);return c.addApp(t,67,!0),a[c.id]=c,c.id},this.createDNSServer=function(e,t){c=new Host("dnsserver",1),c.getDrawable().setPosition(e,t),c.getDrawable().setImage(o[IMAGE_SERVERDNS]);t=new DNSServer(0);return c.addApp(t,53,!0),a[c.id]=c,c.id},this.createHTTPServer=function(e,t){c=new Host("httpserver",1),c.getDrawable().setPosition(e,t),c.getDrawable().setImage(o[IMAGE_SERVERWEB]);t=new HTTPServer(0);return c.addApp(t,80,!0),a[c.id]=c,c.id},this.createSwitch=function(e,t,n){return s=new Host("switch",n),s.getDrawable().setPosition(e,t),s.getDrawable().setImage(o[IMAGE_SWITCH]),a[s.id]=s,s.id},this.createRouter=function(e,t){return r=new Host("router",2),r.getDrawable().setPosition(e,t),r.getDrawable().setImage(o[IMAGE_ROUTER]),a[r.id]=r,r.id},this.createLink=function(e,t,n,i){e=a[e],n=a[n],t=e.getConnectable().getConnector(t),n=n.getConnectable().getConnector(i),i=!1;return null!==t&&null!==n&&(n=new Link(t,n),l.push(n),i=l.length),i},this.getElement=function(e){return a[e]},this.getLink=function(e){var t=null;return t=e<l.length?l[e]:t},this.findNextConnectorInPath=function(e,t,n){for(var i=null,o=1e5,r=0;r<e.getConnectorNumber();r++){var a=[];a.push(e);a=function e(t,n,i,o){var r=-1;if(t.isConnected()){var a=t.getConnectedConnector().getConnectable();if(-1===o.indexOf(a))if(a.compatibleIP(n,!1)||a.compatibleMAC(i,!1))r=0;else{for(var s=1e5,l=0;l<a.getConnectorNumber();l++){o.push(a);var c=e(a.getConnector(l),n,i,o);-1!==(c=-1===c?-1:c+1)&&c<s&&(r=a.getConnector(l),s=c)}1e5!==s&&(r=s)}}return r}(e.getConnector(r),t,n,a);-1!==(a=-1===a?-1:a+1)&&a<o&&(i=e.getConnector(r),o=a)}return i},this.getElementInCoords=function(e,t){for(var n=null,i=0,o=Object.keys(a);null===n&&i<o.length;)a[o[i]].getDrawable().hasCoords(e,t)?n=a[o[i]]:i++;return n},this.getMessageInCoords=function(e,t){for(var n=null,i=0;null===n&&i<l.length;){for(var o=l[i].getMessageCount(),r=0;null===n&&r<o;)l[i].messageHasCoords(r,e,t)?n=l[i].getMessage(r):r++;null===n&&i++}return n},this.getPosForElement=function(e){return a.indexOf(e)},this.getLinkInCoords=function(e,t){for(var n=null,i=0;null===n&&i<l.length;)l[i].hasCoords(e,t)?n=l[i]:i++;return n},this.setSelected=function(e){p=e},this.getSelected=function(){return p},this.deleteSelectedLink=function(){v(p),p=null},this.deleteSelectedElement=function(){!function(e){for(var t=p.getConnectable().getConnectorNumber(),n=0;n<t;n++){var i=p.getConnectable().getConnector(n);null!==i.getLink()&&v(i.getLink())}e=a.indexOf(e),delete a[e]}(p),p.dispose(),p=null},this.save=function(){var e={version:1};e.lastusedid=lastusedid,e.elements=[],e.links=[];for(var t=Object.keys(a),n=0;n<t.length;n++)e.elements.push(a[t[n]].save());for(n=0;n<l.length;n++)e.links.push(l[n].save());return JSON.stringify(e)},this.load=function(e){uimanager.reset(),1===e.version&&function(e){l=[],a=[];for(var t=0;t<e.elements.length;t++){var n=null,i=1;e.elements[t].ports?i=e.elements[t].ports:"router"===e.elements[t].type&&(i=2),(n=new Host(e.elements[t].type,i)).load(e.elements[t]),a[n.id]=n}for(t=0;t<e.links.length;t++){var o=u.findConnector(e.links[t].connector1),r=u.findConnector(e.links[t].connector2),r=new Link(o,r);r.load(e.links[t]),l.push(r)}lastusedid=e.lastusedid}(e)},this.findConnector=function(e){for(var t=Object.keys(a),n=null,i=0;null===n&&i<t.length;)n=a[t[i]].getConnectable().findConnector(e),i++;return n}};function newElement(e){switch(e){case"host":network.createComputer(0,50);break;case"dns":network.createDNSServer(0,50);break;case"dhcp":network.createDHCPServer(0,50);break;case"web":network.createHTTPServer(0,50);break;case"switch":network.createSwitch(0,50,8);break;case"router":network.createRouter(0,50)}}function simulator(e){images=e;var t=document.getElementById("simcontainer"),n=document.getElementById("simcanvas"),e=t.offsetWidth*window.devicePixelRatio,t=t.offsetHeight*window.devicePixelRatio;n.width=e,n.height=t;n=n.getContext("2d",{antialias:!0});uimanager=new UIManager,(network=new Network(images,n,e,t)).init(),null!==NetworkSimulator.initialdata&&network.load(NetworkSimulator.initialdata),createControlsWindow()}var TrafficManager=function(g,c,f){this.id=getNextID();var g=g,d=[],c=c,f=f,u=[],p=this,n=[],v=[];function h(e){n.push(e);e=document.getElementById("diagnosticsconsole");null!==e&&(e.innerHTML=p.getDiagnosticsInfo())}this.save=function(){var e,t={version:1};for(e in t.id=this.id,t.limitbroadcast=c,t.performNAT=f,t.NATtable=[],u)u[e].fixed&&t.NATtable.push(u[e]);return t},this.load=function(e){this.id=e.id,c=e.limitbroadcast,f=e.performNAT;for(var t=0;t<e.NATtable.length;t++)this.addNATEntry(e.NATtable[t].newport,e.NATtable[t].port,e.NATtable[t].ip,e.NATtable[t].originIface||ROUTER_WAN,e.NATtable[t].fixed)},this.registerApplication=function(e,t,n){var i={};i.app=e,i.port=t,i.fixed=n,d[t]=i},this.sendMessage=function(e,t){if(!c&&g.compatibleBroadcastMAC(t.getDestinationMAC()))for(var n,i=0;i<g.getConnectorNumber();i++)(n=g.getConnector(i))!==e&&n.send(t);else(n=g.getSenderConnectorForMAC(t.getDestinationMAC()))!==e&&null!==n&&n.send(t)},this.addNATEntry=function(e,t,n,i,o){u[e]={},u[e].ip=n,u[e].newport=e,u[e].port=t,u[e].originIface=i,u[e].fixed=o},this.getNATData=function(){var e,t=[];for(port in u)u[port].fixed&&((e=[])[0]=u[port].originIface,e[1]=u[port].port,e[2]=u[port].newport,e[3]=u[port].ip,t.push(e));return t},this.removeFixedNATData=function(){for(port in u)u[port].fixed&&this.deleteNATEntry(port)},this.deleteNATEntry=function(e){e in u&&delete u[e]},this.proccess=function(e,t){switch(g.updateAddressing(t.getOriginMAC(),g.getConnectorPos(e)),t.getType()){case"tcp":n=e,i=t,s=!1,l=!(s=g.compatibleMAC(i.getDestinationMAC(),!0))||g.compatibleBroadcastMAC(i.getDestinationMAC())&&!c,s&&(i.decreaseTTL(),i.getDstPort()in d?(d[i.getDstPort()].app.receiveMessage(i),d[i.getDstPort()].fixed||delete d[i.getDstPort()]):f&&!g.compatibleBroadcastMAC(i.getDestinationMAC())?i.getDstPort()in u&&u[i.getDstPort()].originIface==g.getConnectorPos(n)?(o=i.getDstPort(),i.setDestinationIP(u[o].ip),i.setDstPort(u[o].port),null!==(r=g.getDstMAC(i.getDestinationIP()))&&null!==(a=g.getSenderConnectorForMAC(r))&&(i.setDestinationMAC(r),a.send(i)),u[o].fixed||delete u[o]):(s=getDinamycPort(),null!==(r=g.getDstMAC(i.getDestinationIP()))&&null!==(a=g.getSenderConnectorForMAC(r))&&(o=g.getConnectorPos(a),a!==n&&(p.addNATEntry(s,i.getOrigPort(),i.getOriginIP(),o,!1),i.setOriginIP(g.getIPInfo(o).getIPv4()),i.setOriginMAC(g.getMAC(o)),i.setOrigPort(s)),i.setDestinationMAC(r),a.send(i))):g.compatibleBroadcastMAC(i.getDestinationMAC())||null!==(r=g.getDstMAC(i.getDestinationIP()))&&null!==(a=g.getSenderConnectorForMAC(r))&&(i.setDestinationMAC(r),a.send(i))),l&&p.sendMessage(n,i);break;case"icmp":!function(e,t){var n,i,o,r,a,s,l,c,d=g.compatibleMAC(t.getDestinationMAC(),!1),u=null!==e.getIPInfo()&&t.getDestinationIP()===e.getIPInfo().getIPv4();switch(d&&t.decreaseTTL(),t.getData().command){case"ping":d&&u?(i=t.getOriginIP(),o=g.getConnectorPos(e),r=t.getId(),p.pingResponse(i,o,r)):d&&!u&&f?null!==(l=g.getDstMAC(t.getDestinationIP()))&&null!==(c=g.getSenderConnectorForMAC(l))&&(c!==e&&(s=g.getConnectorPos(c),(n={}).ip=t.getOriginIP(),n.mac=t.getOriginMAC(),v[t.getId()]=n,t.setOriginIP(g.getIPInfo(s).getIPv4()),t.setOriginMAC(g.getMAC(s))),t.setDestinationMAC(l),c.send(t)):!d||u||f?d||p.sendMessage(e,t):null!==(l=g.getDstMAC(t.getDestinationIP()))&&null!==(c=g.getSenderConnectorForMAC(l))&&(t.setDestinationMAC(l),c.send(t));break;case"traceroute":d&&u?(i=t.getOriginIP(),o=g.getConnectorPos(e),r=t.getId(),p.tracerouteResponse(i,o,r,!0,t.getData().seq+1,t.getDestinationIP())):d&&!u&&f?null!==(l=g.getDstMAC(t.getDestinationIP()))&&null!==(c=g.getSenderConnectorForMAC(l))&&(i=t.getOriginIP(),o=g.getConnectorPos(e),r=t.getId(),a=t.getData().seq+1,p.tracerouteResponse(i,o,r,!1,a,t.getDestinationIP()),c!==e&&(s=g.getConnectorPos(c),(n={}).ip=t.getOriginIP(),n.mac=t.getOriginMAC(),v[t.getId()]=n,t.setOriginIP(g.getIPInfo(s).getIPv4()),t.setOriginMAC(g.getMAC(s))),t.getData().seq=a,t.setDestinationMAC(l),c.send(t)):!d||u||f?d||p.sendMessage(e,t):null!==(l=g.getDstMAC(t.getDestinationIP()))&&null!==(c=g.getSenderConnectorForMAC(l))&&(i=t.getOriginIP(),o=g.getConnectorPos(e),r=t.getId(),a=t.getData().seq+1,p.tracerouteResponse(i,o,r,!1,a,t.getDestinationIP()),s=g.getConnectorPos(c),t.getData().seq=a,t.setOriginMAC(g.getMAC(s)),t.setDestinationMAC(l),c.send(t));break;case"pingresponse":d&&t.getData().originMessageId in v?(t.setDestinationIP(v[t.getData().originMessageId].ip),t.setDestinationMAC(v[t.getData().originMessageId].mac),p.sendMessage(e,t),delete v[t.getData().originMessageId]):!d||!u||t.getData().originMessageId in v?!d||u||t.getData().originMessageId in v?d||p.sendMessage(e,t):null!==(l=g.getDstMAC(t.getDestinationIP()))&&null!==(c=g.getSenderConnectorForMAC(l))&&(t.setDestinationMAC(l),c.send(t)):h(_("Ping response recieved from ")+t.getOriginIP());break;case"tracerouteresponse":d&&t.getData().originMessageId in v?(t.setDestinationIP(v[t.getData().originMessageId].ip),t.setDestinationMAC(v[t.getData().originMessageId].mac),p.sendMessage(e,t),t.getData().final&&delete v[t.getData().originMessageId]):!d||!u||t.getData().originMessageId in v?!d||u||t.getData().originMessageId in v?d||p.sendMessage(e,t):null!==(l=g.getDstMAC(t.getDestinationIP()))&&null!==(c=g.getSenderConnectorForMAC(l))&&(t.setDestinationMAC(l),c.send(t)):h(t.getData().seq+_(" - Traceroute to ")+t.getData().dstIp+": "+t.getOriginIP())}}(e,t)}var n,i,o,r,a,s,l},this.getFixedNATtable=function(){var e,t=[];for(e in u)u[e].fixed&&(t[e]={},t[e].port=u[e].port,t[e].ip=u[e].ip);return t},this.getDiagnosticsInfo=function(){for(var e="",t=n.length-1;0<=t;t--)e+=n[t]+(t===n.length?"":"<br/>");return e},this.ping=function(e,t){var n,i;null!==g.getIPInfo(t).getIPv4()?(i=null)===(i=isValidIPv4(e)?e:g.getOwner().getApp("DNSClient").getIp(e))?h("Unknown domain: "+e):null!==(n=g.getDstMAC(i))?((e={command:"ping"}).description="PING: "+i,e=new Message("icmp",g.getIPInfo(t).getIPv4(),i,g.getMAC(t),n,-1,-1,e,images[IMAGE_ENVELOPEICMP]),h(_("Sending ping to: ")+e.getDestinationIP()),g.getConnector(t).send(e)):h(_("Network unreachable: ")+i):h(_("Network not configured for interface: ")+t)},this.traceroute=function(e,t){var n,i;null!==g.getIPInfo(t).getIPv4()?(i=null)===(i=isValidIPv4(e)?e:g.getOwner().getApp("DNSClient").getIp(e))?h("Unknown domain: "+e):null!==(n=g.getDstMAC(i))?((e={command:"traceroute"}).description="Traceroute: "+i,e.seq=0,e=new Message("icmp",g.getIPInfo(t).getIPv4(),i,g.getMAC(t),n,-1,-1,e,images[IMAGE_ENVELOPEICMP]),h(_("Sending traceroute to: ")+e.getDestinationIP()),g.getConnector(t).send(e)):h(_("Network unreachable: ")+i):h(_("Network not configured for interface: ")+t)},this.pingResponse=function(e,t,n){var i,o=null;null===(o=isValidIPv4(e)?e:g.getOwner().getApp("DNSClient").getIp(e))?h("Unknown domain: "+e):null!==(i=g.getDstMAC(o))&&((e={command:"pingresponse",description:"PING Response"}).originMessageId=n,e=new Message("icmp",g.getIPInfo(t).getIPv4(),o,g.getMAC(t),i,-1,-1,e,images[IMAGE_ENVELOPEICMP]),g.getConnector(t).send(e))},this.tracerouteResponse=function(e,t,n,i,o,r){var a,s=null;null===(s=isValidIPv4(e)?e:g.getOwner().getApp("DNSClient").getIp(e))?h("Unknown domain: "+e):null!==(a=g.getDstMAC(s))&&((e={command:"tracerouteresponse"}).originMessageId=n,e.final=i,e.seq=o,e.dstIp=r,e.description="Traceroute Response",e=new Message("icmp",g.getIPInfo(t).getIPv4(),s,g.getMAC(t),a,-1,-1,e,images[IMAGE_ENVELOPEICMP]),g.getConnector(t).send(e))},this.setPerformNAT=function(e){f=e}};function UIClickable(e,t,n){this.isInCoords=function(e,t,n){alert("This function needs to be redefined - isInCoords")},this.performAction=function(){null!==e&&e(t)},this.getObject=function(){return n}}function sqr(e){return e*e}function dist2(e,t){return sqr(e.x-t.x)+sqr(e.y-t.y)}function distToSegmentSquared(e,t,n){var i=dist2(t,n);if(0==i)return dist2(e,t);i=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/i;return dist2(e,i<0?t:1<i?n:{x:t.x+i*(n.x-t.x),y:t.y+i*(n.y-t.y)})}function distToSegment(e,t,n){return Math.sqrt(distToSegmentSquared(e,t,n))}function UILine(e,t,n,i,o,r,a,s){UIClickable.call(this,e,t,n),this.X1=i,this.Y1=o,this.X2=r,this.Y2=a,this.Z=s,this.setCoords=function(e,t,n,i,o){this.X1=e,this.Y1=t,this.X2=n,this.Y2=i,this.Z=o},this.isInCoords=function(e,t){return distToSegment({x:e,y:t},{x:this.X1,y:this.Y1},{x:this.X2,y:this.Y2})<LINE_SELECT_TOLERANCE}}function createLinkAction(){uimanager.createLinkAction()}function createBkDiv(){var e=document.createElement("div"),t=document.body.scrollWidth,n=document.body.scrollHeight;e.setAttribute("style","position:absolute;top:0;left:0;z-index:100;background-color:white;width:"+t+"px;height:"+n+"px;opacity:0.25;"),e.setAttribute("id","divbk"),document.body.appendChild(e)}function saveNetwork(){var e=document.getElementById("filename").value,t=document.createElement("a");t.setAttribute("href","data:text/plain;charset:utf-8,"+encodeURIComponent(network.save())),t.setAttribute("download",e),document.body.appendChild(t),t.click(),document.body.removeChild(t),cancelDownload()}function removeBodyDiv(e){e=document.getElementById(e);document.body.removeChild(e)}function cancelUpload(){uimanager.getWindow("divupload").dispose(),removeBodyDiv("divbk")}function cancelDownload(){uimanager.getWindow("divdownload").dispose(),removeBodyDiv("divbk")}function confirmUpload(){var e=document.getElementById("uploaddata").files[0],t=new FileReader;t.onload=function(e){e=JSON.parse(e.target.result);network.load(e)},t.readAsText(e),uimanager.getWindow("divupload").dispose(),removeBodyDiv("divbk")}function createUploadDiv(){document.createElement("div");var e='<p>  <input type="button" id="upload" value="'+_("Upload")+'" onclick="confirmUpload();" />  <input type="button" id="cancel" value="'+_("Cancel")+'" onclick="cancelUpload();" />  </p>',t=new UIWindow("divupload",_("Upload file"),400,150,!1,1);t.setContent('<p><input type="file" id="uploaddata" name="uploaddata" /></p>'),t.setControls(e),t.render()}function createDownloadDiv(){document.createElement("div");var e='<p><label for="filename">'+_("File name:")+'</label><input type="text" id="filename" name="filename" value="network.json" /></p>',t='<p>  <input type="button" id="upload" value="'+_("Download")+'" onclick="saveNetwork();" />  <input type="button" id="cancel" value="'+_("Cancel")+'" onclick="cancelDownload();" />  </p>',n=new UIWindow("divdownload",_("Download file"),400,150,!1,1);n.setContent(e),n.setControls(t),n.render()}function uploadClick(){createBkDiv(),createUploadDiv()}function downloadClick(){createBkDiv(),createDownloadDiv()}UILine.prototype=new UIClickable,UILine.prototype.constructor=UILine;var UIManager=function(){var e,o=0,r=1,a=2,s=3,l=5,c=6,d=7,u=8,g=0,f=1,p=2,v=3,h=4,m=5,I=6,t=[],b=[],n=[],w=(document.getElementById("simcanvas"),o),C=null,i=this,D=0,P=0,k=null,A=0,E=0;function S(e){C.getVisible()?C.hide():C.show()}function y(e){var t=document.getElementById("simcanvas"),n=t.getBoundingClientRect();U((e.clientX-n.left)*(t.width/n.width),(e.clientY-n.top)*(t.height/n.height),g)}function N(e){var t=document.getElementById("simcanvas"),n=t.getBoundingClientRect();U((e.clientX-n.left)*(t.width/n.width),(e.clientY-n.top)*(t.height/n.height),f)}function T(e){var t=document.getElementById("simcanvas"),n=t.getBoundingClientRect(),i=(e.clientX-n.left)*(t.width/n.width),n=(e.clientY-n.top)*(t.height/n.height);U(A=i,E=n,p)}function M(){for(var e in t)t[e].getVisible()&&t[e].hide()}function x(e,t,n){e=e.getRect();D=t-e.x,P=n-e.y}function O(e){e.getVisible()?e.hide():e.show()}function H(e){network.setSelected(e),e.getDrawable().addObserver(i);var t=e.getDrawable().getRect();k=new UIRectangle(O,e.getMenu(),i,t.x+t.width-10,t.y,10,10,50),i.addClickable(k)}function L(e){network.setSelected(e);var t=e.getCenter();k=new UIRectangle(O,e.getMenu(),i,t.x-5,t.y-5,10,10,50),e.getMenu().setPos(t.x+5,t.y-5),i.addClickable(k)}function G(e){null!==e&&e.getMenu().getVisible()&&(e.getMenu().hide(),e.getDrawable().deleteObserver(i)),i.removeClickable(k),network.setSelected(null)}function R(){network.setSelected(null)}function U(e,t,n){switch(w){case o:n===g&&null!==(i=B(e,t))&&(i.getObject()===C?(M(),i.performAction(),w=c):i.getObject()instanceof Drawable?(x(i.getObject(),e,t),M(),H(i.getObject().getOwner()),w=r):i.getObject()instanceof Link&&(M(),L(i.getObject()),w=s));break;case c:switch(n){case g:null!==(i=B(e,t))?i.getObject()===C?(i.performAction(),w=o):i.getObject()instanceof Drawable?(x(i.getObject(),e,t),C.hide(),H(i.getObject().getOwner()),w=r):i.getObject()instanceof Link&&(M(),L(i.getObject()),w=s):(C.hide(),w=o);break;case v:C.hide(),w=o}break;case r:switch(n){case f:w=a;break;case p:network.getSelected().getDrawable().setPosition(e-D,t-P)}break;case a:n===g&&(null!==(i=B(e,t))?i.getObject()===C?(M(),i.performAction(),network.setSelected(null),w=c):i.getObject()instanceof Drawable?(M(),G(network.getSelected()),H(i.getObject().getOwner()),w=r):i.getObject()instanceof UIManager?(i.performAction(),w=d):i.getObject()instanceof Link&&(M(),L(i.getObject()),w=s):(network.setSelected(null),w=o));break;case s:n===g&&(null!==(i=B(e,t))?i.getObject()===C?(M(),i.performAction(),network.setSelected(null),w=c):i.getObject()instanceof Drawable?(M(),R(network.getSelected()),H(i.getObject().getOwner()),w=r):i.getObject()instanceof UIManager?(i.performAction(),w=u):i.getObject()instanceof Link&&(M(),L(i.getObject()),w=s):(network.setSelected(null),w=o));break;case u:switch(n){case g:null!==(i=B(e,t))?i.getObject()===C?(M(),i.performAction(),network.setSelected(null),w=c):i.getObject()instanceof Drawable?(M(),R(network.getSelected()),H(i.getObject().getOwner()),w=r):i.getObject()instanceof UIManager?(i.performAction(),w=s):i.getObject()instanceof Link&&(M(),L(i.getObject()),w=s):(M(),R(network.getSelected()),w=o);break;case m:M(),R(network.getSelected()),w=o}break;case d:switch(n){case g:null!==(i=B(e,t))?i.getObject()===C?(M(),i.performAction(),network.setSelected(null),w=c):i.getObject()instanceof Drawable?(M(),G(network.getSelected()),H(i.getObject().getOwner()),w=r):i.getObject()instanceof UIManager?(i.performAction(),w=d):i.getObject()instanceof Link&&(M(),L(i.getObject()),w=s):(G(network.getSelected()),M(),w=o);break;case v:M(),w=a;break;case h:M(),G(network.getSelected()),w=o;break;case I:M(),w=l}break;case l:var i;n===g&&(null!==(i=B(e,t))?i.getObject()instanceof Drawable&&(M(),selectLinkConnectors(network.getSelected().id,i.getObject().getOwner().id),w=a):(M(),w=a))}}function B(e,t){for(var n=null,i=0;i<b.length;i++)b[i].isInCoords(e,t)&&(null===n||b[i].Z>n.Z)&&(n=b[i]);return n}this.addWindow=function(e){n[e.getId()]=e},this.getWindow=function(e){return n[e]},this.removeWindow=function(e){delete n[e.getId()]},this.reset=function(){this.clickables=[];var e=new UIRectangle(S,null,C,5,5,35,50,10,!0);this.addClickable(e)},this.drawableChanged=function(){var e;null!==network.getSelected()&&(e=network.getSelected().getDrawable().getRect(),k.X=e.x+e.width-10,k.Y=e.y)},this.menuOptionClicked=function(){U(-1,-1,v)},this.selectedElementDeleted=function(){U(-1,-1,h)},this.selectedLineDeleted=function(){U(-1,-1,m)},this.createLinkAction=function(){U(-1,-1,I)},this.addMenu=function(e){t[e.getId()]=e},this.deleteMenu=function(e){t[e.getId()].dispose(),delete t[e.getId()]},this.getMenu=function(e){return t[e]},this.addClickable=function(e){b.push(e)},this.removeClickable=function(e){e=b.indexOf(e);b.splice(e,1)},this.render=function(e){var t,n,i;i=e,w===r||w===a||w===d||w===l?(n=network.getSelected().getDrawable().getRect(),i.strokeStyle="rgba(100,100,100,0.75)",i.lineWidth=5,i.strokeRect(n.x,n.y,n.width,n.height),i.fillStyle="rgba(255,255,255,0.75)",i.strokeStyle="rgba(255,255,255,0.75)",i.fillRect(k.X,k.Y,k.W,k.H),i.lineWidth=2,i.strokeRect(k.X,k.Y,k.W,k.H)):w!==s&&w!==u||(n=network.getSelected().getCenter(),i.fillStyle="rgba(255,255,255,0.75)",i.strokeStyle="rgba(255,255,255,0.75)",i.fillRect(n.x-5,n.y-5,10,10),i.lineWidth=2,i.strokeRect(n.x-5,n.y-5,10,10)),t=e,w===l&&(n=(i=network.getSelected().getDrawable().getRect()).x+i.width/2,i=i.y+i.height/2,t.strokeStyle="rgba(128,255,128,1.0)",t.lineWidth=2,t.beginPath(),t.moveTo(n,i),t.lineTo(A,E),t.stroke()),function(e){e.fillStyle="rgba(255,255,255,0.5)",e.fillRect(5,document.body.scrollTop+5,35,50),e.strokeStyle="rgba(255,255,255,1.0)",e.lineWidth=4,e.strokeRect(5,document.body.scrollTop+5,35,50),e.lineWidth=5;for(var t=15;t<50;t+=10)e.strokeRect(12,document.body.scrollTop+t,21,0)}(e)},this.getMousePos=function(){return{X:A,Y:E}},(e=document.getElementById("simcanvas")).addEventListener("mousedown",y,!1),e.addEventListener("mouseup",N,!1),e.addEventListener("mousemove",T,!1),e=e.getBoundingClientRect(),(C=new UIMenu("Main menu",42+e.left,3,!0)).addEntry("img/64/upload.png",_("Upload"),"uploadClick();"),C.addEntry("img/64/save.png",_("Save"),"downloadClick();"),C.addEntry("img/64/computer.png",_("Add Host"),'newElement("host");'),C.addEntry("img/64/server_dhcp.png",_("Add DHCP server"),'newElement("dhcp");'),C.addEntry("img/64/server_dns.png",_("Add DNS server"),'newElement("dns");'),C.addEntry("img/64/server_web.png",_("Add web server"),'newElement("web");'),C.addEntry("img/64/switch.png",_("Add switch"),'newElement("switch");'),C.addEntry("img/64/router2.png",_("Add router"),'newElement("router");'),C.addEntry("img/64/i18n.png",_("Select language"),"createLocaleDiv();"),i.addMenu(C),e=new UIRectangle(S,null,C,5,5,35,50,10,!0),i.addClickable(e)},UIMenu=function(i,o,r,a){var o=o,r=r,s=[],l="uimenu_"+getNextID(),i=i,c=!1,a=a,e=this;this.dispose=function(){uitranslation.deleteObserver(this)},this.localeChanged=function(){},this.getId=function(){return l},this.getVisible=function(){return c},this.addEntry=function(e,t,n){var i={};i.id="entry_"+getNextID(),i.img=e,i.text=t,i.js=n,s.push(i)},this.setPos=function(e,t){o=e,r=t},this.setDescription=function(e){i=e},this.purge=function(){s=[]},this.show=function(){var e=document.createElement("div");e.setAttribute("id",l),e.setAttribute("style","width:200px;background-color:#EEEEEE;border:3px solid white;position:"+(a?"fixed":"absolute")+";top:"+r+"px;left:"+o+"px;font-size:0.8em;padding:0px 10px 0px;");for(var t="<span style='font-weight:bold'>"+_(i)+"</span><hr/>",n=0;n<s.length;n++)t+="<a href='#' onclick='"+s[n].js+"uimanager.menuOptionClicked();'>",t+="<img src='"+s[n].img+"' style='max-height:32px;max-width:32px;' />",t+="<span id='"+s[n].id+"'>"+_(s[n].text)+"</span></a><br/>",n!==s.length-1&&(t+="<hr/>");e.innerHTML=t,document.body.appendChild(e),c=!0},this.hide=function(){var e=document.getElementById(l);document.body.removeChild(e),c=!1},uitranslation.addObserver(e)};function UIRectangle(e,t,n,i,o,r,a,s,l){UIClickable.call(this,e,t,n),this.X=i,this.Y=o,this.W=r,this.H=a,this.Z=s;this.setCoords=function(e,t,n,i,o){this.X=e,this.Y=t,this.W=n,this.H=i,this.Z=o},this.isInCoords=function(e,t){return l&&(e-=document.body.scrollLeft,t-=document.body.scrollTop),this.X<=e&&e<=this.X+this.W&&this.Y<t&&t<this.Y+this.H}}UIRectangle.prototype=new UIClickable,UIRectangle.prototype.constructor=UIRectangle;var lasttableid=0,uitables=[];function getNextTableID(){return++lasttableid}function deleteUITableRow(e,t){uitables[e].deleteRow(t)}function addUITableRow(e){uitables[e].addRow()}var UITable=function(i,o,r){var i=i,o=o,r=r,a="uitable_"+getNextTableID(),s=!1,l=null,n=[];(uitables[a]=this).getId=function(){return a},this.setParam=function(e,t){n[e]=t},this.getParam=function(e){var t=null;return t=e in n?n[e]:t},this.setSecondary=function(e,t){s=e,l=t},this.render=function(){var e="";e+="<tr>";for(var t=0;t<i.length;t++)e+="<th>"+i[t]+"</th>";e+="<th>"+_("Controls")+"</th>",e+="</tr>";for(t=0;t<o.length;t++){e+="<tr>";for(var n=0;n<i.length;n++)e+="<td>",e+='<input type="text" id="'+(r+"_"+t+"_"+n)+'" value="'+o[t][n]+'" disabled="disabled" />',e+="</td>";e+="<td>",e+='<img src="img/64/delete.png" title="'+_("Delete")+'" alt="'+_("Delete")+'" style="width:24px;" onclick="deleteUITableRow(\''+a+"',"+t+')" />',s&&(e+='<img src="img/64/edit.png" title="'+_("Edit")+'" alt="'+_("Edit")+'" style="width:24px;" onclick="'+l+"('"+a+"',"+t+')" />'),e+="</td>",e+="</tr>"}e+="<tr>";for(n=0;n<i.length;n++)e+="<td>",e+='<input type="text" id="'+(r+"_new_"+n)+'" />',e+="</td>";e+='<td><img src="img/64/add.png" title="'+_("Add")+'" alt="'+_("Add")+'" style="width:24px;" onclick="addUITableRow(\''+a+"')\" /></td>",e+="</tr>",document.getElementById(r).innerHTML=e},this.deleteRow=function(e){o.splice(e,1),this.render()},this.dispose=function(){delete uitables[a]},this.getData=function(){return o},this.addRow=function(){for(var e=[],t=0;t<i.length;t++){var n=r+"_new_"+t,n=document.getElementById(n).value;e.push(n)}o.push(e),this.render()}};function createLocaleDiv(){createBkDiv();var e=new UIWindow("localediv","Select language",300,150,!1,1),t=uitranslation.getControls(),n='<input type="button" value="'+_("Accept")+'" onclick="localeSelected();" />';n+='<input type="button" value="'+_("Cancel")+'" onclick="localeCancelled();" />',e.setContent(t),e.setControls(n),e.render()}function localeSelected(){var e=document.getElementById("localeselector").value;uitranslation.selectLocale(e),removeBodyDiv("divbk"),uimanager.getWindow("localediv").dispose()}function localeCancelled(){removeBodyDiv("divbk"),uimanager.getWindow("localediv").dispose()}function _(e){return uitranslation._(e)}var UITranslation=function(){var n="en_GB",i=[],t=[];this.registerLocale=function(e){i[e.locale]=e},this.getLocales=function(){return Object.keys(i)},this.addObserver=function(e){t.push(e)},this.removeObserver=function(e){e=t.indexOf(e);0<=e&&t.splice(e,1)},this.selectLocale=function(e){n=e,function(){for(var e=0;e<t.length;e++)t[e].localeChanged()}()},this._=function(e){var t=e;return t=n in i&&e in i[n]?i[n][e]:t},this.getControls=function(){var e='<label for="localeselector">'+_("Language:")+' </label><select id="localeselector">';for(locale in i){var t=i[locale].locale===n?'selected="selected"':"";e+='<option value="'+i[locale].locale+'" '+t+">"+i[locale].name+"</option>"}return e+="</select>"}},uitranslation=new UITranslation,UIWindow=function(e,t,n,i,o,r){var a=0,s=1,l=s,c=0,d=1,u=2,t=t,n=n,i=i,g=window.innerWidth/2-n/2,f=window.innerHeight/2-i/2,r=r,e=e,p=p+"_contents",v=v+"_controls",h=null,m=null,I=null,b=null,w=0,C=0,D=this;function P(e){var t=m.getBoundingClientRect(),n=e.clientX,e=e.clientY;t.left<=n&&n<=t.left+t.width&&t.top<=e&&e<=t.top+t.height&&E(n,e,c)}function k(e){E(-1,-1,d)}function A(e){E(e.clientX,e.clientY,u)}function E(e,t,n){switch(l){case a:switch(n){case d:l=s;break;case u:g=e-w+scrollX,f=t-C+scrollY,h.setAttribute("style",S())}break;case s:var i;n===c&&(i=m.getBoundingClientRect(),w=e-i.left,C=t-i.top,l=a)}}function S(){return"position:absolute;top:"+f+"px;left:"+g+"px;z-index:110;background-color:white;width:"+n+"px;height:"+i+"px;border-radius:10px;border:1px solid;padding:10px;text-align:center;opacity:"+r+";"}this.render=function(){h.appendChild(m),h.appendChild(I),h.appendChild(b),document.body.appendChild(h)},this.setControls=function(e){b.innerHTML=e},this.setContent=function(e){I.innerHTML=e},this.dispose=function(){window.removeEventListener("mousedown",P),window.removeEventListener("mouseup",k),window.removeEventListener("mousemove",A),uimanager.removeWindow(this),removeBodyDiv(e),uitranslation.removeObserver(this)},this.getId=function(){return e},this.getPos=function(){return{x:g,y:f}},this.setPos=function(e,t){g=e,f=t,h.setAttribute("style",S())},this.localeChanged=function(){m.innerHTML=_(t)},(h=document.createElement("div")).setAttribute("id",e),h.setAttribute("style",S()),(m=document.createElement("div")).setAttribute("id",e+"_title"),m.setAttribute("style","width:100%;height:20px;background-color:blue;color:white;font-weight:bold;-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;"),m.innerHTML=_(t),(I=document.createElement("div")).setAttribute("id",p),I.setAttribute("style","width:100%; height:"+i-80+"px;"),(b=document.createElement("div")).setAttribute("id",v),b.setAttribute("style","width:100%; height:40px;"),window.addEventListener("mousedown",P,!0),window.addEventListener("mouseup",k,!0),window.addEventListener("mousemove",A,!0),uimanager.addWindow(D),uitranslation.addObserver(D)},en_GB={name:"English (GB)",locale:"en_GB"};uitranslation.registerLocale(en_GB);var es_ES={name:"Español",locale:"es_ES","Animation Controls":"Controles de Animación",Accept:"Aceptar",Cancel:"Cancelar","Language:":"Idioma:","Select language":"Selecciona idioma",Upload:"Cargar",Save:"Guardar","Add Host":"Añadir equipo","Add DHCP server":"Añadir servidor DHCP","Add DNS server":"Añadir servidor DNS","Add web server":"Añadir servidor web","Add switch":"Añadir switch","Add router":"Añadir router","Delete element":"Eliminar","Edit Name / Group":"Editar nombre/grupo","Create Link":"Crear enlace","Network diagnostics":"Diagnósticos de red","Edit Gateways":"Editar gateways","Edit IP Info - Interface 0":"Editar información IP - Interfaz 0","Edit IP Info - WAN":"Editar información IP - WAN","Edit IP Info - LAN":"Editar información IP - LAN","Edit NAT table":"Editar tabla NAT","Main menu":"Menú principal","Upload file":"Cargar fichero","Request DHCP info":"Solicitar info. DHCP","DNS lookup":"Búsqueda DNS","Web browser (HTTP client)":"Navegador web (cliente HTTP)","Edit name / group":"Editar nombre / grupo",Exit:"Salir","Group:":"Grupo:","Name:":"Nombre:","Interface ":"Interfaz ",Network:"Red",Mask:"Máscara",Gateway:"Gateway",Controls:"Controles","Gateway Configuration":"Configuración de gateways","IP Address:":"Dirección IP:","Network Mask:":"Máscara de red:","DNS 1:":"DNS 1:","DNS 2:":"DNS 2:","Edit IP Info":"Editar Info IP:","Domain:":"Dominio:",Lookup:"Buscar",Domain:"Dominio",IP:"IP","DNS Server":"Servidor DNS","Forwarder:":"Forwarder:","DNS server config":"Configurar servidor DNS","DHCP Server":"Servidor DHCP","Initial:":"Inicial:","Final:":"Final:","Gateway:":"Gateway:",Close:"Cerrar","HTTP Client (Browser)":"Cliente HTTP (Navegador)","Loading...":"Cargando...","404 - Not found":"404 - No encontrado","Malformed URL.\n\nUse only 'domain_or_ip/filename.html'.":"URL incorrecta.\n\nUsa sólo 'dominio_o_ip/fichero.html'.","DNS client not present.":"Falta cliente DNS.","Domain not in local DNS cache. Look up first.\n\nIf you already performed a lookup, the domain does not exist.":"El dominio no está en la caché local. Busca primero.\n\nSi ya has realizado la búsqueda, el dominio no existe..","Edit DHCP server info":"Editar información del servidor DHCP","HTTP Server":"Servidor HTTP",File:"Fichero",Back:"Atrás","HTTP Domain Files":"Ficheros del Dominio HTTP","HTTP Domain File Edition":"Edición de Fichero del Dominio HTTP","Input interface":"Interfaz de entrada","WAN Port":"Puerto WAN","LAN Port":"Puerto LAN","IP: ":"IP: ","Gateway mode (uses NAT).":"Modo gateway (usa NAT).","Edit NAT":"Editar NAT","Edit HTTP server info":"Editar información del servidor HTTP",Delete:"Eliminar",Edit:"Editar",Add:"Añadir","Sending traceroute to: ":"Enviando traceroute a: ","Sending ping to: ":"Enviando ping a: ","Ping response recieved from ":"Respuesta a ping recibida de "," - Traceroute to ":" - Traceroute a ","Network unreachable: ":"Red inaccesible: ","Network not configured for interface: ":"Red no configurada para la interfaz: ","File name:":"Nombre del fichero:",Download:"Descargar","Download file":"Descargar fichero"};uitranslation.registerLocale(es_ES);var eu_ES={name:"Euskara",locale:"eu_ES","Animation Controls":"Animazio kontrolak",Accept:"Onartu",Cancel:"Ezeztatu","Language:":"Hizkuntza:","Select language":"Aukeratu hizkuntza",Upload:"Kargatu",Save:"Gorde","Add Host":"Gehitu ordenagailua","Add DHCP server":"Gehitu DHCP zerbitzaria","Add DNS server":"Gehitu DNS zerbitzaria","Add web server":"Gehitu web zerbitzaria","Add switch":"Gehitu switch","Add router":"Gehitu router","Delete element":"Ezabatu","Edit Name / Group":"Izena/taldea editatu","Create Link":"Sortu lotura","Network diagnostics":"Sare diagnostikoak","Edit Gateways":"Gateway-ak editatu","Edit IP Info - Interface 0":"IP informazioa editatu - Interfaze 0","Edit IP Info - WAN":"IP informazioa editatu - WAN","Edit IP Info - LAN":"IP informazioa editatu - LAN","Edit NAT table":"NAT taula editatu","Main menu":"Menu nagusia","Upload file":"Fitxategia kargatu","Request DHCP info":"DHCP info eskatu","DNS lookup":"DNS bilaketa","Web browser (HTTP client)":"Nabigatzaile (HTTP bezeroa)","Edit name / group":"Izena / taldea editatu",Exit:"Irten","Group:":"Taldea:","Name:":"Izena:","Interface ":"Interfaze ",Network:"Sarea",Mask:"Maskara",Gateway:"Gateway",Controls:"Kontrolak","Gateway Configuration":"Gateway-ak konfiguratu","IP Address:":"IP Helbidea:","Network Mask:":"Sare-maskara:","DNS 1:":"DNS 1:","DNS 2:":"DNS 2:","Edit IP Info":"IP Info editatu","Domain:":"Domeinua:",Lookup:"Bilatu",Domain:"Domeinua",IP:"IP","DNS Server":"DNS Zerbitzaria","Forwarder:":"Forwarder:","DNS server config":"DNS zerbitzaria konfiguratu","DHCP Server":"DHCP Zerbitzaria","Initial:":"Lehena:","Final:":"Azkena:","Gateway:":"Gateway:",Close:"Itxi","HTTP Client (Browser)":"HTTP Bezeroa (Nabigatzailea)","Loading...":"Kargatzen...","404 - Not found":"404 - Ez da aurkitu","Malformed URL.\n\nUse only 'domain_or_ip/filename.html'.":"URL ez da zuzena.\n\nErabili 'domeinu_edo_ip/fitxategia.html' bakarrik.","DNS client not present.":"DNS bezeroa ez dago.","Domain not in local DNS cache. Look up first.\n\nIf you already performed a lookup, the domain does not exist.":"Domeinua ez dago DNS cachean. Lehenik eta behin, bilatu.\n\nBilaketa jada eginda badago, domeinua ez dago.","Edit DHCP server info":"Editatu DHCP zerbitzariaren informazioa","HTTP Server":"HTTP Zerbitzaria",File:"Fitxategia",Back:"Atzera","HTTP Domain Files":"HTTP Domeinuaren Fitxategiak","HTTP Domain File Edition":"HTTP Domeinuaren Fitxategia Editatu","Input interface":"Sarrera Interfazea","WAN Port":"WAN Ataka","LAN Port":"LAN Ataka","IP: ":"IP: ","Gateway mode (uses NAT).":"Gateway modua (NAT erabiltzen du).","Edit NAT":"NAT editatu","Edit HTTP server info":"HTTP zerbitzariaren informazioa editatu",Delete:"Ezabatu",Edit:"Editatu",Add:"Gehitu","Sending traceroute to: ":"Traceroute bidaltzen honako helbide honetara: ","Sending ping to: ":"Ping bidaltzen honako helbide honetara: ","Ping response recieved from ":"Ping erantzuna honako helbide honetatik: "," - Traceroute to ":" - Traceroute honako helbide honetara: ","Network unreachable: ":"Sarea eskuraezina: ","Network not configured for interface: ":"Sarea ez dago konfiguratuta interfaze honetan: ","File name:":"Fitxategiaren izena:",Download:"Deskargatu","Download file":"Deskargatu fitxategia"};uitranslation.registerLocale(eu_ES);var fr_FR={name:"Français",locale:"fr_FR","Animation Controls":"Contrôle des animations",Accept:"Accepter",Cancel:"échappement","Language:":"Langue :","Select language":"Sélection de langue",Upload:"Téléverser",Save:"Enregistrer","Add Host":"Ajouter un ordinateur","Add DHCP server":"Ajouter un serveur DHCP","Add DNS server":"Ajouter un serveur DNS","Add web server":"Añadir servidorAjouter un serveur web","Add switch":"Ajouter un switch","Add router":"AñadirAjouter un routeur","Delete element":"Supprimer","Edit Name / Group":"Éditer le nom / le groupe","Create Link":"Relier","Network diagnostics":"Diagnostics réseau","Edit Gateways":"Éditer les gateways","Edit IP Info - Interface 0":"Éditer l'adresse IP - Interface 0","Edit IP Info - WAN":"Éditer l'adresse IP - WAN","Edit IP Info - LAN":"Éditer l'adresse IP - LAN","Edit NAT table":"Éditer la table de NAT","Main menu":"Menu principal","Upload file":"Téléverser un fichier","Request DHCP info":"Demander l'info DHCP","DNS lookup":"Requête DNS","Web browser (HTTP client)":"Navigateur web (client HTTP)","Edit name / group":"Éditer le nom / le groupe",Exit:"Quitter","Group:":"Groupe :","Name:":"Nom :","Interface ":"Interface ",Network:"Réseau",Mask:"Masque",Gateway:"Gateway",Controls:"Contrôles","Gateway Configuration":"Configuration de gateways","IP Address:":"Adresse IP :","Network Mask:":"Masque réseau :","DNS 1:":"DNS 1:","DNS 2:":"DNS 2:","Edit IP Info":"Éditer l'adresse IP :","Domain:":"Domaine :",Lookup:"Recherche",Domain:"Domaine",IP:"IP","DNS Server":"Serveur DNS","Forwarder:":"Transmetteur :","DNS server config":"Configurer le serveur DNS","DHCP Server":"Serveur DHCP","Initial:":"Initial :","Final:":"Final :","Gateway:":"Gateway :",Close:"Fermer","HTTP Client (Browser)":"Client HTTP (Navigateur)","Loading...":"Chargement en cours ...","404 - Not found":"404 - Pas trouvé","Malformed URL.\n\nUse only 'domain_or_ip/filename.html'.":"URL incorrecte.\n\nUtiliser seulement 'domaine_ou_ip/fichier.html'.","DNS client not present.":"Client DNS absent.","Domain not in local DNS cache. Look up first.\n\nIf you already performed a lookup, the domain does not exist.":"Le domaine n'est pas dans lSi la recherche a déjà été faite, le domaine n'existe pas ..","Edit DHCP server info":"Éditer l'information du serveur DHCP","HTTP Server":"Serveur HTTP",File:"Fichier",Back:"Retour","HTTP Domain Files":"Fichiers du domaine HTTP","HTTP Domain File Edition":"Édition d'un fichier du domaine HTTP","Input interface":"Interface de l'entrée","WAN Port":"Port WAN","LAN Port":"Port LAN","IP: ":"IP : ","Gateway mode (uses NAT).":"Mode gateway (utilise NAT).","Edit NAT":"Éditer le NAT","Edit HTTP server info":"Éditer l'information du serveur HTTP",Delete:"Supprimer",Edit:"Éditer",Add:"Ajouter","Sending traceroute to: ":"Envoi d'un traceroute à : ","Sending ping to: ":"Envoi d'un ping à : ","Ping response recieved from ":"Réponse du ping reçue de "," - Traceroute to ":" - Traceroute @ ","Network unreachable: ":"Réseau inaccessible : ","Network not configured for interface: ":"Réseau non configuré pour l'interface : ","File name:":"Nom du fichier :",Download:"Télécharger","Download file":"Télécharger un fichier"};uitranslation.registerLocale(fr_FR);